<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Event Source - SES - Sparta</title>
    <meta name="generator" content="Hugo 0.29" />

    
    <meta name="description" content="Sparta - Go framework for AWS Lambda">
    
    <link rel="canonical" href="http://gosparta.io/docs/eventsources/ses/">
    
    <meta name="author" content="Matt Weagle">
    

    <meta property="og:url" content="http://gosparta.io/docs/eventsources/ses/">
    <meta property="og:title" content="Sparta">
    <meta property="og:image" content="http://gosparta.io/images/SpartaHelmet.png">
    <meta name="apple-mobile-web-app-title" content="Sparta">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://gosparta.io/favicons/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://gosparta.io/favicons/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://gosparta.io/fonts/icon.eot');
        src: url('http://gosparta.io/fonts/icon.eot')
               format('embedded-opentype'),
             url('http://gosparta.io/fonts/icon.woff')
               format('woff'),
             url('http://gosparta.io/fonts/icon.ttf')
               format('truetype'),
             url('http://gosparta.io/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://gosparta.io/stylesheets/application.css">
    <link rel="stylesheet" href="http://gosparta.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://gosparta.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="http://gosparta.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,700|Roboto&#43;Mono">
    <style>
      body, input {
        font-family: 'Roboto', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="http://gosparta.io/css/sparta.css">
    
    <link rel="stylesheet" href="http://gosparta.io/external/mermaid_dist/mermaid.css">
    
    <link rel="stylesheet" href="http://gosparta.io/external/font-awesome-4.7.0/css/font-awesome.min.css">
    
    <script src="http://gosparta.io/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-grey palette-accent-indigo">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Event Source - SES
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/mweagle" title="@mweagle on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/mweagle" title="@mweagle on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/mweagle/Sparta" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://gosparta.io/images/SpartaHelmet.png">
        </div>
      
      <div class="name">
        <strong>Sparta <span class="version">0.20.1</span></strong>
        
          <br>
          mweagle/Sparta
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/mweagle/Sparta/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/mweagle/Sparta/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Sparta" href="http://gosparta.io/">
	
	Sparta
</a>



  
</li>



<li>
  
    



<a  title="Overview" href="http://gosparta.io/docs/overview">
	
	Overview
</a>



  
</li>



<li>
  
    



<a  title="Sample Service" href="http://gosparta.io/docs/intro_example/intro">
	
	Sample Service
</a>



  
</li>



<li>
  
    <span class="section">Documentation</span>
    <ul>
      
        
        



<a  title="Event Sources" href="http://gosparta.io/docs/eventsources/eventsources/">
	
	Event Sources
</a>



      
        
        



<a  title="API Gateway" href="http://gosparta.io/docs/apigateway/apigateway/">
	
	API Gateway
</a>



      
        
        



<a  title="S3 Sites with CORS" href="http://gosparta.io/docs/s3site/">
	
	S3 Sites with CORS
</a>



      
        
        



<a  title="Dynamic Infrastructure" href="http://gosparta.io/docs/dynamic_infrastructure/">
	
	Dynamic Infrastructure
</a>



      
        
        



<a  title="Discovery Service" href="http://gosparta.io/docs/discovery/">
	
	Discovery Service
</a>



      
        
        



<a  title="Application Customization" href="http://gosparta.io/docs/application/application/">
	
	Application Customization
</a>



      
        
        



<a  title="Custom Resources" href="http://gosparta.io/docs/custom_resources/">
	
	Custom Resources
</a>



      
        
        



<a  title="Python/cgo Support" href="http://gosparta.io/docs/cgo/">
	
	Python/cgo Support
</a>



      
        
        



<a  title="Hybrid Topologies" href="http://gosparta.io/docs/hybrid_topologies/">
	
	Hybrid Topologies
</a>



      
        
        



<a  title="CI/CD" href="http://gosparta.io/docs/cicd/">
	
	CI/CD
</a>



      
        
        



<a  title="Docker" href="http://gosparta.io/docs/docker/">
	
	Docker
</a>



      
        
        



<a  title="Local Testing" href="http://gosparta.io/docs/local_testing/">
	
	Local Testing
</a>



      
    </ul>
  
</li>



<li>
  
    



<a  title="Limitations" href="http://gosparta.io/docs/limitations">
	
	Limitations
</a>



  
</li>



<li>
  
    



<a  title="FAQ" href="http://gosparta.io/docs/faq">
	
	FAQ
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/mweagle" target="_blank" title="@mweagle on Twitter">
              @mweagle on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/mweagle" target="_blank" title="@mweagle on GitHub">
              @mweagle on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:mweagle@gmail.com" title="Email of mweagle@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Event Source - SES </h1>

			

<p>In this section we&rsquo;ll walkthrough how to trigger your lambda function in response to inbound email.  This overview is based on the <a href="https://github.com/mweagle/SpartaApplication/blob/master/application.go">SpartaApplication</a> sample code if you&rsquo;d rather jump to the end result.</p>

<h1 id="goal">Goal</h1>

<p>Assume that we have already <a href="http://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-domains.html">verified our email domain</a> with AWS.  This allows our domain&rsquo;s email to be handled by SES.</p>

<p>We&rsquo;ve been asked to write a lambda function that logs inbound messages, including the metadata associated with the message body itself.</p>

<p>There is also an additional requirement to support <a href="http://radar.oreilly.com/2015/06/an-introduction-to-immutable-infrastructure.html">immutable infrastructure</a>, so our service needs to manage the S3 bucket to which message bodies should be stored.  Our service cannot rely on a pre-existing S3 bucket.  The infrastructure (and associated security policies) together with the application logic is coupled.</p>

<h1 id="getting-started">Getting Started</h1>

<p>We&rsquo;ll start with an empty lambda function and build up the needed functionality.</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span><span style=""> </span><span style="color:#a6e22e">echoSESEvent</span><span style="">(</span><span style="color:#a6e22e">w</span><span style=""> </span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">ResponseWriter</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">r</span><span style=""> </span><span style="color:#f92672">*</span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">Request</span><span style="">)</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">	</span><span style="color:#a6e22e">logger</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">_</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">r</span><span style="">.</span><span style="color:#a6e22e">Context</span><span style="">().</span><span style="color:#a6e22e">Value</span><span style="">(</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">ContextKeyLogger</span><span style="">).(</span><span style="color:#f92672">*</span><span style="color:#a6e22e">logrus</span><span style="">.</span><span style="color:#a6e22e">Logger</span><span style="">)</span><span style="">
</span><span style="">	</span><span style="color:#a6e22e">lambdaContext</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">_</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">r</span><span style="">.</span><span style="color:#a6e22e">Context</span><span style="">().</span><span style="color:#a6e22e">Value</span><span style="">(</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">ContextKeyLambdaContext</span><span style="">).(</span><span style="color:#f92672">*</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">LambdaContext</span><span style="">)</span><span style="">
</span><span style="">	</span><span style="color:#a6e22e">logger</span><span style="">.</span><span style="color:#a6e22e">WithFields</span><span style="">(</span><span style="color:#a6e22e">logrus</span><span style="">.</span><span style="color:#a6e22e">Fields</span><span style="">{</span><span style="">
</span><span style="">		</span><span style="color:#e6db74">&#34;RequestID&#34;</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">lambdaContext</span><span style="">.</span><span style="color:#a6e22e">AWSRequestID</span><span style="">,</span><span style="">
</span><span style="">	</span><span style="">}).</span><span style="color:#a6e22e">Info</span><span style="">(</span><span style="color:#e6db74">&#34;Request received&#34;</span><span style="">)</span></code></pre>
</div>

<h1 id="unmarshalling-the-ses-event">Unmarshalling the SES Event</h1>

<p>At this point we would normally continue processing the SES event, using Sparta types if available.</p>

<p>However, before moving on to the event unmarshaling, we need to take a detour into <a href="http://gosparta.io/docs/dynamic_infrastructure/">dynamic infrastructure</a> because of the immutable infrastructure requirement.</p>

<p>This requirement implies that our service must be self-contained: we can&rsquo;t assume that &ldquo;something else&rdquo; has created an S3 bucket.  How can our locally compiled code access AWS-created resources?</p>

<h1 id="dynamic-resources">Dynamic Resources</h1>

<p>The immutable infrastructure requirement makes this lambda function a bit more complex.  Our service needs to:</p>

<ul>
<li>Provision a new S3 bucket for email message body storage

<ul>
<li>SES will not provide the message body in the event data.  It will only store the email body in an S3 bucket, from which your lambda function can later consume it.</li>
</ul></li>
<li>Wait for the S3 bucket to be provisioned

<ul>
<li>As we need a new S3 bucket, we&rsquo;re relying on AWS to generate a <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-bucket.html#cfn-s3-bucket-name">unique name</a>.  But this means that our lambda function doesn&rsquo;t know the S3 bucket name during provisioning.</li>
<li>In fact, we shouldn&rsquo;t even create an AWS Lambda function if the S3 bucket can&rsquo;t be created.</li>
</ul></li>
<li>Include an IAMPrivilege so that our <strong>go</strong> function can access the dynamically created bucket</li>
<li>Discover the S3 Bucket at lambda execution time</li>
</ul>

<h2 id="provision-message-body-storage-resource">Provision Message Body Storage Resource</h2>

<p>Let&rsquo;s first take a look at how the SES lambda handler provisions a new S3 bucket via the <a href="https://godoc.org/github.com/mweagle/Sparta#MessageBodyStorage">MessageBodyStorage</a> type:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span><span style=""> </span><span style="color:#a6e22e">appendSESLambda</span><span style="">(</span><span style="color:#a6e22e">api</span><span style=""> </span><span style="color:#f92672">*</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">API</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">lambdaFunctions</span><span style=""> </span><span style="">[]</span><span style="color:#f92672">*</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">LambdaAWSInfo</span><span style="">)</span><span style="">
</span><span style="">  </span><span style="">[]</span><span style="color:#f92672">*</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">LambdaAWSInfo</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">
</span><span style="">	</span><span style="color:#75715e">// Our lambda function will need to be able to read from the bucket, which
</span><span style="color:#75715e"></span><span style="">	</span><span style="color:#75715e">// will be handled by the S3MessageBodyBucketDecorator below
</span><span style="color:#75715e"></span><span style="">	</span><span style="color:#a6e22e">lambdaFn</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">HandleAWSLambda</span><span style="">(</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">LambdaName</span><span style="">(</span><span style="color:#a6e22e">echoSESEvent</span><span style="">),</span><span style="">
</span><span style="">		</span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">HandlerFunc</span><span style="">(</span><span style="color:#a6e22e">echoSESEvent</span><span style="">),</span><span style="">
</span><span style="">		</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">IAMRoleDefinition</span><span style="">{})</span><span style="">
</span><span style="">	</span><span style="color:#75715e">// Setup options s.t. the lambda function has time to consume the message body
</span><span style="color:#75715e"></span><span style="">	</span><span style="color:#a6e22e">lambdaFn</span><span style="">.</span><span style="color:#a6e22e">Options</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">LambdaFunctionOptions</span><span style="">{</span><span style="">
</span><span style="">		</span><span style="color:#a6e22e">Description</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;&#34;</span><span style="">,</span><span style="">
</span><span style="">		</span><span style="color:#a6e22e">MemorySize</span><span style="">:</span><span style="">  </span><span style="color:#ae81ff">128</span><span style="">,</span><span style="">
</span><span style="">		</span><span style="color:#a6e22e">Timeout</span><span style="">:</span><span style="">     </span><span style="color:#ae81ff">10</span><span style="">,</span><span style="">
</span><span style="">	</span><span style="">}</span><span style="">
</span><span style="">
</span><span style="">  </span><span style="color:#75715e">// Add a Permission s.t. the Lambda function automatically manages SES registration
</span><span style="color:#75715e"></span><span style="">  </span><span style="color:#a6e22e">sesPermission</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">SESPermission</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">BasePermission</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">BasePermission</span><span style="">{</span><span style="">
</span><span style="">      </span><span style="color:#75715e">// SES only supports wildcard ARNs
</span><span style="color:#75715e"></span><span style="">      </span><span style="color:#a6e22e">SourceArn</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;*&#34;</span><span style="">,</span><span style="">
</span><span style="">    </span><span style="">},</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">InvocationType</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;Event&#34;</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="">}</span><span style="">
</span><span style="">  </span><span style="color:#75715e">// Store the message body
</span><span style="color:#75715e"></span><span style="">  </span><span style="color:#a6e22e">bodyStorage</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">_</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">NewMessageBodyStorageResource</span><span style="">(</span><span style="color:#e6db74">&#34;Special&#34;</span><span style="">)</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">MessageBodyStorage</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="color:#a6e22e">bodyStorage</span></code></pre>
</div>

<p>The <code>MessageBodyStorage</code> type (and the related <a href="https://godoc.org/github.com/mweagle/Sparta#MessageBodyStorageOptions">MessageBodyStorageOptions</a> type) cause our SESPermission handler to  add an <a href="http://docs.aws.amazon.com/ses/latest/DeveloperGuide/receiving-email-action-s3.html">S3 ReceiptRule</a> at the head of the rules list.  This rule instructs SES to store the message body in the supplied bucket before invoking our lambda function.</p>

<p>The single parameter <code>&quot;Special&quot;</code> is an application-unique literal value that is used to create a stable CloudFormation resource identifier so that new buckets are not created in response to stack update requests.</p>

<p>Our SES handler then adds two <a href="http://docs.aws.amazon.com/ses/latest/APIReference/API_ReceiptRule.html">ReceiptRules</a>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">ReceiptRules</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="">make</span><span style="">([]</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">ReceiptRule</span><span style="">,</span><span style=""> </span><span style="color:#ae81ff">0</span><span style="">)</span><span style="">
</span><span style=""></span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">ReceiptRules</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="">append</span><span style="">(</span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">ReceiptRules</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">ReceiptRule</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Name</span><span style="">:</span><span style="">       </span><span style="color:#e6db74">&#34;Special&#34;</span><span style="">,</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Recipients</span><span style="">:</span><span style=""> </span><span style="">[]</span><span style="color:#66d9ef">string</span><span style="">{</span><span style="color:#e6db74">&#34;sombody_special@gosparta.io&#34;</span><span style="">},</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">TLSPolicy</span><span style="">:</span><span style="">  </span><span style="color:#e6db74">&#34;Optional&#34;</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="">})</span><span style="">
</span><span style=""></span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">ReceiptRules</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="">append</span><span style="">(</span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">ReceiptRules</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">ReceiptRule</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Name</span><span style="">:</span><span style="">       </span><span style="color:#e6db74">&#34;Default&#34;</span><span style="">,</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Recipients</span><span style="">:</span><span style=""> </span><span style="">[]</span><span style="color:#66d9ef">string</span><span style="">{},</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">TLSPolicy</span><span style="">:</span><span style="">  </span><span style="color:#e6db74">&#34;Optional&#34;</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="">})</span></code></pre>
</div>

<h2 id="dynamic-iamprivilege-arn">Dynamic IAMPrivilege Arn</h2>

<p>Our lambda function is required to access the message body in the dynamically created <code>MessageBodyStorage</code> resource, but the S3 resource Arn is only defined <em>after</em> the service is provisioned.  The solution to this is to reference the dynamically generated <code>BucketArnAllKeys()</code> value in the <code>sparta.IAMRolePrivilege</code> initializer:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Then add the privilege to the Lambda function s.t. we can actually get at the data
</span><span style="color:#75715e"></span><span style="color:#a6e22e">lambdaFn</span><span style="">.</span><span style="color:#a6e22e">RoleDefinition</span><span style="">.</span><span style="color:#a6e22e">Privileges</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="">append</span><span style="">(</span><span style="color:#a6e22e">lambdaFn</span><span style="">.</span><span style="color:#a6e22e">RoleDefinition</span><span style="">.</span><span style="color:#a6e22e">Privileges</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">IAMRolePrivilege</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Actions</span><span style="">:</span><span style="">  </span><span style="">[]</span><span style="color:#66d9ef">string</span><span style="">{</span><span style="color:#e6db74">&#34;s3:GetObject&#34;</span><span style="">,</span><span style=""> </span><span style="color:#e6db74">&#34;s3:HeadObject&#34;</span><span style="">},</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Resource</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">MessageBodyStorage</span><span style="">.</span><span style="color:#a6e22e">BucketArnAllKeys</span><span style="">(),</span><span style="">
</span><span style=""></span><span style="">})</span></code></pre>
</div>

<p>The last step is to register the <code>SESPermission</code> with the lambda info:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Finally add the SES permission to the lambda function
</span><span style="color:#75715e"></span><span style="color:#a6e22e">lambdaFn</span><span style="">.</span><span style="color:#a6e22e">Permissions</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="">append</span><span style="">(</span><span style="color:#a6e22e">lambdaFn</span><span style="">.</span><span style="color:#a6e22e">Permissions</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">sesPermission</span><span style="">)</span></code></pre>
</div>

<p>At this point we&rsquo;ve implicitly created an S3 bucket via the <code>MessageBodyStorage</code> value.  Our lambda function now needs to dynamically determine the AWS-assigned bucket name.</p>

<h2 id="dynamic-message-body-storage-discovery">Dynamic Message Body Storage Discovery</h2>

<p>Our <code>echoSESEvent</code> function needs to determine, at execution time, the <code>MessageBodyStorage</code> S3 bucket name.  This is done via <code>sparta.Discover()</code>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">configuration</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">configErr</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">Discover</span><span style="">()</span><span style="">
</span><span style="">
</span><span style=""></span><span style="color:#a6e22e">logger</span><span style="">.</span><span style="color:#a6e22e">WithFields</span><span style="">(</span><span style="color:#a6e22e">logrus</span><span style="">.</span><span style="color:#a6e22e">Fields</span><span style="">{</span><span style="">
</span><span style="">  </span><span style="color:#e6db74">&#34;Error&#34;</span><span style="">:</span><span style="">         </span><span style="color:#a6e22e">configErr</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#e6db74">&#34;Configuration&#34;</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">configuration</span><span style="">,</span><span style="">
</span><span style=""></span><span style="">}).</span><span style="color:#a6e22e">Debug</span><span style="">(</span><span style="color:#e6db74">&#34;Discovery results&#34;</span><span style="">)</span></code></pre>
</div>

<p>The <code>sparta.Discover()</code> function returns a <a href="https://godoc.org/github.com/mweagle/Sparta#DiscoveryInfo">DiscoveryInfo</a> structure.  This structure is the unmarshaled CloudFormation <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-attribute-metadata.html">Metadata</a> of the CloudFormation <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-function.html">Lambda::Function</a> resource.</p>

<p>The structure includes the stack&rsquo;s <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html">Pseudo Parameters</a> as well information about any <em>immediate</em> resource dependencies.  Eg, those that were explicitly marked as <code>DependsOn</code>.  See the <a href="http://gosparta.io/docs/discovery/">discovery documentation</a> for more details.</p>

<p>Of note is that <code>sparta.Discover()</code> does not accept any parameters and instead uses <a href="https://golang.org/pkg/reflect/">reflect</a> to determine which <a href="https://godoc.org/github.com/mweagle/Sparta#LambdaAWSInfo">sparta.LamdaAWSInfo</a> structure to lookup.  Discovery is therefore limited to being called from a <em>Sparta-compliant Go lambda function</em> only.</p>

<p>It will return the full set of data iff:</p>

<ul>
<li>It&rsquo;s called from a <code>Sparta.LambdaFunction</code> function</li>
<li>That function has immediate AWS resource dependencies</li>
</ul>

<p>A sample <code>DiscoveryInfo</code> for SES is below :</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json"><span style="">{</span><span style="">
</span><span style="">  </span><span style="color:#f92672">&#34;Region&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;us-west-2&#34;</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#f92672">&#34;StackID&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;arn:aws:cloudformation:us-west-2:123412341234:stack/SpartaApplication/a94e1e70-cc2a-11e5-b38e-50d5ca789e4a&#34;</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#f92672">&#34;StackName&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;SpartaApplication&#34;</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="color:#f92672">&#34;Resources&#34;</span><span style="">:</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#f92672">&#34;SESMessageStoreBucketa622fdfda5789d596c08c79124f12b978b3da772&#34;</span><span style="">:</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">      </span><span style="color:#f92672">&#34;ResourceID&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;SESMessageStoreBucketa622fdfda5789d596c08c79124f12b978b3da772&#34;</span><span style="">,</span><span style="">
</span><span style="">      </span><span style="color:#f92672">&#34;Properties&#34;</span><span style="">:</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">        </span><span style="color:#f92672">&#34;DomainName&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;spartaapplication-sesmessagestorebucketa622fdfda5-1ide79vkwrklp.s3.amazonaws.com&#34;</span><span style="">,</span><span style="">
</span><span style="">        </span><span style="color:#f92672">&#34;Ref&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;spartaapplication-sesmessagestorebucketa622fdfda5-1ide79vkwrklp&#34;</span><span style="">,</span><span style="">
</span><span style="">        </span><span style="color:#f92672">&#34;WebsiteURL&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;http://spartaapplication-sesmessagestorebucketa622fdfda5-1ide79vkwrklp.s3-website-us-west-2.amazonaws.com&#34;</span><span style="">,</span><span style="">
</span><span style="">        </span><span style="color:#f92672">&#34;sparta:cloudformation:restype&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;AWS::S3::Bucket&#34;</span><span style="">
</span><span style="">      </span><span style="">},</span><span style="">
</span><span style="">      </span><span style="color:#f92672">&#34;Tags&#34;</span><span style="">:</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">        </span><span style="color:#f92672">&#34;sparta:logicalBucketName&#34;</span><span style="">:</span><span style=""> </span><span style="color:#e6db74">&#34;Special&#34;</span><span style="">
</span><span style="">      </span><span style="">}</span><span style="">
</span><span style="">    </span><span style="">}</span><span style="">
</span><span style="">  </span><span style="">}</span><span style="">
</span><span style=""></span><span style="">}</span></code></pre>
</div>

<p>Note that the <code>Resources</code> map has an entry for the S3 bucket.  Our code just needs to root around a bit to find the <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-bucket.html">Ref</a> property which is the immediate dependencies bucket name output.  If there were multiple resources, we could have disambiguated by also filtering for the <em>Special</em> tag, which is the logical name we provided earlier:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">sesPermission</span><span style="">.</span><span style="color:#a6e22e">NewMessageBodyStorageResource</span><span style="">(</span><span style="color:#e6db74">&#34;Special&#34;</span><span style="">)</span></code></pre>
</div>

<p>As we only have a single dependency, our discovery filter is:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// The message bucket is an explicit `DependsOn` relationship, so it&#39;ll be in the
</span><span style="color:#75715e">// resources map.  We&#39;ll find it by looking for the dependent resource with the &#34;AWS::S3::Bucket&#34; type
</span><span style="color:#75715e"></span><span style="color:#a6e22e">bucketName</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#e6db74">&#34;&#34;</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">for</span><span style=""> </span><span style="color:#a6e22e">_</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">eachResource</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#66d9ef">range</span><span style=""> </span><span style="color:#a6e22e">configuration</span><span style="">.</span><span style="color:#a6e22e">Resources</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">  </span><span style="color:#66d9ef">if</span><span style=""> </span><span style="color:#a6e22e">eachResource</span><span style="">.</span><span style="color:#a6e22e">Properties</span><span style="">[</span><span style="color:#a6e22e">sparta</span><span style="">.</span><span style="color:#a6e22e">TagResourceType</span><span style="">]</span><span style=""> </span><span style="color:#f92672">==</span><span style=""> </span><span style="color:#e6db74">&#34;AWS::S3::Bucket&#34;</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">bucketName</span><span style=""> </span><span style="">=</span><span style=""> </span><span style="color:#a6e22e">eachResource</span><span style="">.</span><span style="color:#a6e22e">Properties</span><span style="">[</span><span style="color:#e6db74">&#34;Ref&#34;</span><span style="">]</span><span style="">
</span><span style="">  </span><span style="">}</span><span style="">
</span><span style=""></span><span style="">}</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">if</span><span style=""> </span><span style="color:#e6db74">&#34;&#34;</span><span style=""> </span><span style="color:#f92672">==</span><span style=""> </span><span style="color:#a6e22e">bucketName</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">logger</span><span style="">.</span><span style="color:#a6e22e">Error</span><span style="">(</span><span style="color:#e6db74">&#34;Failed to discover SES bucket from sparta.Discovery&#34;</span><span style="">)</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">Error</span><span style="">(</span><span style="color:#a6e22e">w</span><span style="">,</span><span style=""> </span><span style="color:#e6db74">&#34;Failed to discovery SES MessageBodyBucket&#34;</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">StatusInternalServerError</span><span style="">)</span><span style="">
</span><span style=""></span><span style="">}</span></code></pre>
</div>

<h1 id="sparta-integration">Sparta Integration</h1>

<p>The rest of <code>echoSESEvent</code> satisfies the other requirements, with a bit of help from the SES <a href="https://godoc.org/github.com/mweagle/Sparta/aws/ses">event types</a>:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">decoder</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">json</span><span style="">.</span><span style="color:#a6e22e">NewDecoder</span><span style="">(</span><span style="color:#a6e22e">r</span><span style="">.</span><span style="color:#a6e22e">Body</span><span style="">)</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">defer</span><span style=""> </span><span style="color:#a6e22e">r</span><span style="">.</span><span style="color:#a6e22e">Body</span><span style="">.</span><span style="color:#a6e22e">Close</span><span style="">()</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">var</span><span style=""> </span><span style="color:#a6e22e">lambdaEvent</span><span style=""> </span><span style="color:#a6e22e">spartaSES</span><span style="">.</span><span style="color:#a6e22e">Event</span><span style="">
</span><span style=""></span><span style="color:#a6e22e">err</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">decoder</span><span style="">.</span><span style="color:#a6e22e">Decode</span><span style="">(</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">lambdaEvent</span><span style="">)</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">if</span><span style=""> </span><span style="color:#a6e22e">err</span><span style=""> </span><span style="color:#f92672">!=</span><span style=""> </span><span style="color:#66d9ef">nil</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">logger</span><span style="">.</span><span style="color:#a6e22e">Error</span><span style="">(</span><span style="color:#e6db74">&#34;Failed to unmarshal event data: &#34;</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">err</span><span style="">.</span><span style="color:#a6e22e">Error</span><span style="">())</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">Error</span><span style="">(</span><span style="color:#a6e22e">w</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">err</span><span style="">.</span><span style="color:#a6e22e">Error</span><span style="">(),</span><span style=""> </span><span style="color:#a6e22e">http</span><span style="">.</span><span style="color:#a6e22e">StatusInternalServerError</span><span style="">)</span><span style="">
</span><span style=""></span><span style="">}</span><span style="">
</span><span style="">
</span><span style=""></span><span style="color:#75715e">// Get the metdata about the item...
</span><span style="color:#75715e"></span><span style="color:#a6e22e">svc</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">s3</span><span style="">.</span><span style="color:#a6e22e">New</span><span style="">(</span><span style="color:#a6e22e">session</span><span style="">.</span><span style="color:#a6e22e">New</span><span style="">())</span><span style="">
</span><span style=""></span><span style="color:#66d9ef">for</span><span style=""> </span><span style="color:#a6e22e">_</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">eachRecord</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#66d9ef">range</span><span style=""> </span><span style="color:#a6e22e">lambdaEvent</span><span style="">.</span><span style="color:#a6e22e">Records</span><span style=""> </span><span style="">{</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">logger</span><span style="">.</span><span style="color:#a6e22e">WithFields</span><span style="">(</span><span style="color:#a6e22e">logrus</span><span style="">.</span><span style="color:#a6e22e">Fields</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#e6db74">&#34;Source&#34;</span><span style="">:</span><span style="">     </span><span style="color:#a6e22e">eachRecord</span><span style="">.</span><span style="color:#a6e22e">SES</span><span style="">.</span><span style="color:#a6e22e">Mail</span><span style="">.</span><span style="color:#a6e22e">Source</span><span style="">,</span><span style="">
</span><span style="">    </span><span style="color:#e6db74">&#34;MessageID&#34;</span><span style="">:</span><span style="">  </span><span style="color:#a6e22e">eachRecord</span><span style="">.</span><span style="color:#a6e22e">SES</span><span style="">.</span><span style="color:#a6e22e">Mail</span><span style="">.</span><span style="color:#a6e22e">MessageID</span><span style="">,</span><span style="">
</span><span style="">    </span><span style="color:#e6db74">&#34;BucketName&#34;</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">bucketName</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="">}).</span><span style="color:#a6e22e">Info</span><span style="">(</span><span style="color:#e6db74">&#34;SES Event&#34;</span><span style="">)</span><span style="">
</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">params</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">s3</span><span style="">.</span><span style="color:#a6e22e">HeadObjectInput</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Bucket</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">aws</span><span style="">.</span><span style="color:#a6e22e">String</span><span style="">(</span><span style="color:#a6e22e">bucketName</span><span style="">),</span><span style="">
</span><span style="">    </span><span style="color:#a6e22e">Key</span><span style="">:</span><span style="">    </span><span style="color:#a6e22e">aws</span><span style="">.</span><span style="color:#a6e22e">String</span><span style="">(</span><span style="color:#a6e22e">eachRecord</span><span style="">.</span><span style="color:#a6e22e">SES</span><span style="">.</span><span style="color:#a6e22e">Mail</span><span style="">.</span><span style="color:#a6e22e">MessageID</span><span style="">),</span><span style="">
</span><span style="">  </span><span style="">}</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">resp</span><span style="">,</span><span style=""> </span><span style="color:#a6e22e">err</span><span style=""> </span><span style="color:#f92672">:=</span><span style=""> </span><span style="color:#a6e22e">svc</span><span style="">.</span><span style="color:#a6e22e">HeadObject</span><span style="">(</span><span style="color:#a6e22e">params</span><span style="">)</span><span style="">
</span><span style="">  </span><span style="color:#a6e22e">logger</span><span style="">.</span><span style="color:#a6e22e">WithFields</span><span style="">(</span><span style="color:#a6e22e">logrus</span><span style="">.</span><span style="color:#a6e22e">Fields</span><span style="">{</span><span style="">
</span><span style="">    </span><span style="color:#e6db74">&#34;Error&#34;</span><span style="">:</span><span style="">    </span><span style="color:#a6e22e">err</span><span style="">,</span><span style="">
</span><span style="">    </span><span style="color:#e6db74">&#34;Metadata&#34;</span><span style="">:</span><span style=""> </span><span style="color:#a6e22e">resp</span><span style="">,</span><span style="">
</span><span style="">  </span><span style="">}).</span><span style="color:#a6e22e">Info</span><span style="">(</span><span style="color:#e6db74">&#34;SES MessageBody&#34;</span><span style="">)</span><span style="">
</span><span style=""></span><span style="">}</span></code></pre>
</div>

<h1 id="wrapping-up">Wrapping Up</h1>

<p>With the <code>lambdaFn</code> fully defined, we can provide it to <code>sparta.Main()</code> and deploy our service.  The workflow below is shared by all SES-triggered lambda function:</p>

<ul>
<li>Define the lambda function (<code>echoSESEvent</code>).</li>
<li>If needed, create the required <a href="https://godoc.org/github.com/mweagle/Sparta*IAMRoleDefinition">IAMRoleDefinition</a> with appropriate privileges if the lambda function accesses other AWS services.</li>
<li>Provide the lambda function &amp; IAMRoleDefinition to <code>sparta.NewLambda()</code></li>
<li>Add the necessary <a href="https://godoc.org/github.com/mweagle/Sparta#LambdaAWSInfo">Permissions</a> to the <code>LambdaAWSInfo</code> struct so that the lambda function is triggered.</li>
</ul>

<p>Additionally, if the SES handler needs to access the raw email message body:</p>

<ul>
<li>Create a new <code>sesPermission.NewMessageBodyStorageResource(&quot;Special&quot;)</code> value to store the message body</li>
<li>Assign the value to the <code>sesPermission.MessageBodyStorage</code> field</li>
<li>If your lambda function needs to consume the message body, add an entry to <code>sesPermission.[]IAMPrivilege</code> that includes the <code>sesPermission.MessageBodyStorage.BucketArnAllKeys()</code> Arn</li>
<li>In your <strong>go</strong> lambda function definition, discover the S3 bucketname via <code>sparta.Discover()</code></li>
</ul>

<h1 id="notes">Notes</h1>

<ul>
<li>The SES message (including headers) is stored in the <a href="http://stackoverflow.com/questions/33549327/what-is-the-format-of-the-aws-ses-body-stored-in-s3">raw format</a></li>
<li><code>sparta.Discover()</code> uses <a href="https://golang.org/pkg/reflect/">reflection</a> to map from the current enclosing <strong>go</strong> function name to the owning <a href="https://godoc.org/github.com/mweagle/Sparta#LambdaAWSInfo">LambdaAWSInfo</a> CloudFormation. Therefore, calling <code>sparta.Discover()</code> from non-Sparta lambda functions (application helpers, function literals) will generate an error.</li>
<li>More on Immutable Infrastructure:

<ul>
<li><a href="https://www.subbu.org/blog/2014/10/automate-everything-but-dont-ignore-drift">Subbu - Automate Everything</a></li>
<li><a href="http://chadfowler.com/2013/06/23/immutable-deployments.html">Chad Fowler - Immutable Deployments</a></li>
<li><a href="http://www.thecloudcast.net/2015/09/the-cloudcast-213-what-is-immutable.html">The Cloudcast - What is Immutable Infrastructure</a></li>
<li><a href="http://thenewstack.io/a-brief-look-at-immutable-infrastructure-and-why-it-is-such-a-quest/">The New Stack</a></li>
</ul></li>
</ul>


			<aside class="copyright" role="note">
				
				&copy; 2017 Copyright 2015-2017 Matt Weagle &ndash;
				
				Last built at <b>2017-10-03 07:15:40 &#43;0000 UTC</b> with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://gosparta.io/docs/eventsources/s3/" title="Event Source - S3">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Event Source - S3
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://gosparta.io/docs/eventsources/sns/" title="Event Source - SNS">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Event Source - SNS
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>


    <script>
    
      var base_url = 'http:\/\/gosparta.io\/';
      var repo_id  = 'mweagle\/Sparta';
    
    </script>

    <script src="http://gosparta.io/javascripts/application.js"></script>
    
    <script src="http://gosparta.io/external/mermaid_dist/mermaid.min.js"></script>
    
    <script src="http://gosparta.io/external/jquery/jquery-2.2.0.min.js"></script>
    

    
    <script>mermaid.initialize({startOnLoad:true});</script>


    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-70794971-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

  </body>
</html>

