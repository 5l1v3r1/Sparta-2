<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.55.6" />
    <meta name="description" content="Sparta - AWS Lambda Microservices">
<meta name="author" content="Matt Weagle">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>SES :: Sparta - AWS Lambda Microservices</title>

    
    <link href="/css/nucleus.css?1559541734" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1559541734" rel="stylesheet">
    <link href="/css/hybrid.css?1559541734" rel="stylesheet">
    <link href="/css/featherlight.min.css?1559541734" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1559541734" rel="stylesheet">
    <link href="/css/auto-complete.css?1559541734" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1559541734" rel="stylesheet">
    <link href="/css/theme.css?1559541734" rel="stylesheet">
    <link href="/css/hugo-theme.css?1559541734" rel="stylesheet">
    
      <link href="/css/theme-sparta.css?1559541734" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1559541734"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<style type="text/css">
pre {
    padding: 2px;
}
</style>


  </head>
  <body class="" data-url="/reference/eventsources/ses/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/"><img src="/images/SpartaLogoNoDomain.png" height="50%" width="50%"/></a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1559541734"></script>
<script type="text/javascript" src="/js/auto-complete.js?1559541734"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1559541734"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/concepts/">
          Concepts
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/example_service/" title="Example Service" class="dd-item 
        
        
        
        ">
      <a href="/example_service/">
          Example Service
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/example_service/step1/" title="Overview" class="dd-item ">
        <a href="/example_service/step1/">
        Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/example_service/step2/" title="Details" class="dd-item ">
        <a href="/example_service/step2/">
        Details
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cli_options/" title="CLI Options" class="dd-item 
        
        
        
        ">
      <a href="/cli_options/">
          CLI Options
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/reference/" title="Reference" class="dd-item 
        parent
        
        
        ">
      <a href="/reference/">
          Reference
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/reference/apigateway/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/apigateway/">
          <b>API Gateway</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/echo_event/" title="Echo" class="dd-item ">
        <a href="/reference/apigateway/echo_event/">
        Echo
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/request_params/" title="Request Parameters" class="dd-item ">
        <a href="/reference/apigateway/request_params/">
        Request Parameters
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/context/" title="Request Context" class="dd-item ">
        <a href="/reference/apigateway/context/">
        Request Context
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/cors/" title="CORS" class="dd-item ">
        <a href="/reference/apigateway/cors/">
        CORS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/slack/" title="Slack SlashCommand" class="dd-item ">
        <a href="/reference/apigateway/slack/">
        Slack SlashCommand
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/s3site/" title="S3 Sites with CORS" class="dd-item ">
        <a href="/reference/apigateway/s3site/">
        S3 Sites with CORS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/eventsources/" title="" class="dd-item 
        parent
        
        
        ">
      <a href="/reference/eventsources/">
          <b>Event Sources</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/codecommit/" title="CodeCommit" class="dd-item ">
        <a href="/reference/eventsources/codecommit/">
        CodeCommit
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cloudformation/" title="CloudFormation" class="dd-item ">
        <a href="/reference/eventsources/cloudformation/">
        CloudFormation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cloudwatchevents/" title="CloudWatch Events" class="dd-item ">
        <a href="/reference/eventsources/cloudwatchevents/">
        CloudWatch Events
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cloudwatchlogs/" title="CloudWatch Logs" class="dd-item ">
        <a href="/reference/eventsources/cloudwatchlogs/">
        CloudWatch Logs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cognito/" title="Cognito" class="dd-item ">
        <a href="/reference/eventsources/cognito/">
        Cognito
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/dynamodb/" title="DynamoDB" class="dd-item ">
        <a href="/reference/eventsources/dynamodb/">
        DynamoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/kinesis/" title="Kinesis" class="dd-item ">
        <a href="/reference/eventsources/kinesis/">
        Kinesis
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/s3/" title="S3" class="dd-item ">
        <a href="/reference/eventsources/s3/">
        S3
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/ses/" title="SES" class="dd-item active">
        <a href="/reference/eventsources/ses/">
        SES
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/sns/" title="SNS" class="dd-item ">
        <a href="/reference/eventsources/sns/">
        SNS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/sqs/" title="SQS" class="dd-item ">
        <a href="/reference/eventsources/sqs/">
        SQS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/archetypes/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/archetypes/">
          <b>Archetype Constructors</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/codecommit/" title="CodeCommit" class="dd-item ">
        <a href="/reference/archetypes/codecommit/">
        CodeCommit
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/cloudwatch/" title="CloudWatch" class="dd-item ">
        <a href="/reference/archetypes/cloudwatch/">
        CloudWatch
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/dynamodb/" title="DynamoDB" class="dd-item ">
        <a href="/reference/archetypes/dynamodb/">
        DynamoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/kinesis/" title="Kinesis" class="dd-item ">
        <a href="/reference/archetypes/kinesis/">
        Kinesis
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/rest/" title="REST Service" class="dd-item ">
        <a href="/reference/archetypes/rest/">
        REST Service
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/s3/" title="S3" class="dd-item ">
        <a href="/reference/archetypes/s3/">
        S3
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/sns/" title="SNS" class="dd-item ">
        <a href="/reference/archetypes/sns/">
        SNS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/decorators/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/decorators/">
          <b>Build-Time Decorators</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/cloudmap/" title="CloudMap Service Discovery" class="dd-item ">
        <a href="/reference/decorators/cloudmap/">
        CloudMap Service Discovery
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/cloudfront_distribution/" title="CloudFront Distribution" class="dd-item ">
        <a href="/reference/decorators/cloudfront_distribution/">
        CloudFront Distribution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/lambda_versioning/" title="Lambda Versioning Decorator" class="dd-item ">
        <a href="/reference/decorators/lambda_versioning/">
        Lambda Versioning Decorator
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/publish_outputs/" title="Publishing Outputs" class="dd-item ">
        <a href="/reference/decorators/publish_outputs/">
        Publishing Outputs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/s3_artifact_publisher/" title="S3 Artifact Publisher" class="dd-item ">
        <a href="/reference/decorators/s3_artifact_publisher/">
        S3 Artifact Publisher
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/dynamic_infrastructure/" title="Dynamic Infrastructure" class="dd-item ">
        <a href="/reference/decorators/dynamic_infrastructure/">
        Dynamic Infrastructure
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/interceptors/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/interceptors/">
          <b>Runtime Interceptors</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/interceptors/xray_interceptor/" title="XRayInterceptor" class="dd-item ">
        <a href="/reference/interceptors/xray_interceptor/">
        XRayInterceptor
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/application/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/application/">
          <b>Application Customization</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_commands/" title="Custom Commands" class="dd-item ">
        <a href="/reference/application/custom_commands/">
        Custom Commands
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_flags/" title="Custom Flags" class="dd-item ">
        <a href="/reference/application/custom_flags/">
        Custom Flags
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/environments/" title="Managing Environments" class="dd-item ">
        <a href="/reference/application/environments/">
        Managing Environments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_lambda_resources/" title="CloudFormation Resources" class="dd-item ">
        <a href="/reference/application/custom_lambda_resources/">
        CloudFormation Resources
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_resources/" title="Custom Resources" class="dd-item ">
        <a href="/reference/application/custom_resources/">
        Custom Resources
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/step/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/step/">
          <b>Step Functions</b>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/step/lambda/" title="Lambda" class="dd-item ">
        <a href="/reference/step/lambda/">
        Lambda
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/fargate/" title="Fargate" class="dd-item ">
        <a href="/reference/step/fargate/">
        Fargate
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/step/services/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/step/services/">
          <b>Service Integrations</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/batch/" title="AWS Batch" class="dd-item ">
        <a href="/reference/step/services/batch/">
        AWS Batch
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/fargate/" title="AWS Fargate" class="dd-item ">
        <a href="/reference/step/services/fargate/">
        AWS Fargate
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/glue/" title="AWS Glue" class="dd-item ">
        <a href="/reference/step/services/glue/">
        AWS Glue
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/dynamodb/" title="Amazon DynamoDb" class="dd-item ">
        <a href="/reference/step/services/dynamodb/">
        Amazon DynamoDb
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/sns/" title="Amazon SNS" class="dd-item ">
        <a href="/reference/step/services/sns/">
        Amazon SNS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/sqs/" title="Amazon SQS" class="dd-item ">
        <a href="/reference/step/services/sqs/">
        Amazon SQS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/sagemaker/" title="Amazon SageMaker" class="dd-item ">
        <a href="/reference/step/services/sagemaker/">
        Amazon SageMaker
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/discovery/" title="Discovery Service" class="dd-item ">
        <a href="/reference/discovery/">
        Discovery Service
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/docker/" title="Docker" class="dd-item ">
        <a href="/reference/docker/">
        Docker
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/hybrid_topologies/" title="Hybrid Topologies" class="dd-item ">
        <a href="/reference/hybrid_topologies/">
        Hybrid Topologies
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/operations/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/operations/">
          <b>Operations</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/magefile/" title="Magefiles" class="dd-item ">
        <a href="/reference/operations/magefile/">
        Magefiles
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/cloudwatch_alarms/" title="CloudWatch Alarms" class="dd-item ">
        <a href="/reference/operations/cloudwatch_alarms/">
        CloudWatch Alarms
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/cloudwatch_dashboard/" title="CloudWatch Dashboard" class="dd-item ">
        <a href="/reference/operations/cloudwatch_dashboard/">
        CloudWatch Dashboard
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/codedeploy_service_update/" title="CodeDeploy Service Update" class="dd-item ">
        <a href="/reference/operations/codedeploy_service_update/">
        CodeDeploy Service Update
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/cicd/" title="CI/CD" class="dd-item ">
        <a href="/reference/operations/cicd/">
        CI/CD
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/deployment_strategies/" title="Deployment Strategies" class="dd-item ">
        <a href="/reference/operations/deployment_strategies/">
        Deployment Strategies
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/metrics_publisher/" title="Metrics Publisher" class="dd-item ">
        <a href="/reference/operations/metrics_publisher/">
        Metrics Publisher
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/profiling/" title="Profiling" class="dd-item ">
        <a href="/reference/operations/profiling/">
        Profiling
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/testing/" title="Testing" class="dd-item ">
        <a href="/reference/testing/">
        Testing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/supporting_packages/" title="Supporting Packages" class="dd-item ">
        <a href="/reference/supporting_packages/">
        Supporting Packages
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/limitations/" title="Limitations" class="dd-item ">
        <a href="/reference/limitations/">
        Limitations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/faq/" title="FAQ" class="dd-item ">
        <a href="/reference/faq/">
        FAQ
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/presentations/" title="Presentations" class="dd-item 
        
        
        
        ">
      <a href="/presentations/">
          Presentations
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/credits/" title="Credits" class="dd-item 
        
        
        
        ">
      <a href="/credits/">
          Credits
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/meta/" title="_Meta" class="dd-item 
        
        
        
        ">
      <a href="/meta/">
          _Meta
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/mweagle/Sparta"><i class='fab fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/mweagle?utf8=%E2%9C%93&amp;tab=repositories&amp;q=Sparta&amp;type=&amp;language="><i class='fas fa-fw fa-camera'></i> Showcases</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/mweagle/Sparta/blob/master/CHANGES.md"><i class='fas fa-fw fa-signal'></i> Release History</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
  Build: <a target="_blank" href="https://github.com/mweagle/Sparta/commit/24876a56">24876a56</a><p/>
  Date: 2019-01-31 06:32:51 -0800 PST


<p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/mweagle/Sparta/tree/docs/content/reference/eventsources/ses.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/reference/'>Reference</a> > <a href='/reference/eventsources/'></a> > SES
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li><a href="#goal">Goal</a>
<ul>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#unmarshalling-the-ses-event">Unmarshalling the SES Event</a></li>
<li><a href="#dynamic-resources">Dynamic Resources</a>
<ul>
<li><a href="#provision-message-body-storage-resource">Provision Message Body Storage Resource</a></li>
<li><a href="#dynamic-iamprivilege-arn">Dynamic IAMPrivilege Arn</a></li>
<li><a href="#dynamic-message-body-storage-discovery">Dynamic Message Body Storage Discovery</a></li>
</ul></li>
</ul></li>
<li><a href="#sparta-integration">#Sparta Integration</a></li>
<li><a href="#wrapping-up">Wrapping Up</a></li>
<li><a href="#notes">Notes</a></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              SES
            </h1>
          

        





<p>In this section we&rsquo;ll walkthrough how to trigger your lambda function in response to inbound email.  This overview is based on the <a href="https://github.com/mweagle/SpartaApplication/blob/master/application.go">SpartaApplication</a> sample code if you&rsquo;d rather jump to the end result.</p>

<h1 id="goal">Goal</h1>

<p>Assume that we have already <a href="http://docs.aws.amazon.com/ses/latest/DeveloperGuide/verify-domains.html">verified our email domain</a> with AWS.  This allows our domain&rsquo;s email to be handled by SES.</p>

<p>We&rsquo;ve been asked to write a lambda function that logs inbound messages, including the metadata associated with the message body itself.</p>

<p>There is also an additional requirement to support <a href="http://radar.oreilly.com/2015/06/an-introduction-to-immutable-infrastructure.html">immutable infrastructure</a>, so our service needs to manage the S3 bucket to which message bodies should be stored.  Our service cannot rely on a pre-existing S3 bucket.  The infrastructure (and associated security policies) together with the application logic is coupled.</p>

<h2 id="getting-started">Getting Started</h2>

<p>We&rsquo;ll start with an empty lambda function and build up the needed functionality.</p>

<pre><code class="language-go">import (
  spartaSES &quot;github.com/mweagle/Sparta/aws/ses&quot;
)
func echoSESEvent(ctx context.Context, sesEvent spartaSES.Event) (*spartaSES.Event, error) {
	logger, _ := ctx.Value(sparta.ContextKeyRequestLogger).(*logrus.Entry)
	configuration, configErr := sparta.Discover()
	logger.WithFields(logrus.Fields{
		&quot;Error&quot;:         configErr,
		&quot;Configuration&quot;: configuration,
	}).Info(&quot;Discovery results&quot;)
}
</code></pre>

<h2 id="unmarshalling-the-ses-event">Unmarshalling the SES Event</h2>

<p>At this point we would normally continue processing the SES event, using Sparta types until the
official <a href="https://godoc.org/github.com/aws/aws-lambda-go/events">events</a> are available.</p>

<p>However, before moving on to the event processing, we need to take a detour into <a href="/reference/dynamic_infrastructure/">dynamic infrastructure</a>
because of the immutable infrastructure requirement.</p>

<p>This requirement implies that our service must be self-contained: we can&rsquo;t assume that
the S3 bucket already exists.  How can our locally compiled code access AWS-created resources?</p>

<h2 id="dynamic-resources">Dynamic Resources</h2>

<p>The immutable infrastructure requirement makes this lambda function a bit more complex.  Our service needs to:</p>

<ul>
<li>Provision a new S3 bucket for email message body storage

<ul>
<li>SES will not provide the message body in the event data.  It will only store
the email body in an S3 bucket, from which your lambda function can later consume it.</li>
</ul></li>
<li>Wait for the S3 bucket to be provisioned

<ul>
<li>As we need a new S3 bucket, we&rsquo;re relying on AWS to generate a <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-s3-bucket.html#cfn-s3-bucket-name">unique name</a>.  But this means that our lambda function doesn&rsquo;t know the S3 bucket name during provisioning.</li>
<li>In fact, we shouldn&rsquo;t even create an AWS Lambda function if the S3 bucket can&rsquo;t be created.</li>
</ul></li>
<li>Include an IAMPrivilege so that our <strong>go</strong> function can access the dynamically created bucket</li>
<li>Discover the S3 Bucket at lambda execution time</li>
</ul>

<h3 id="provision-message-body-storage-resource">Provision Message Body Storage Resource</h3>

<p>Let&rsquo;s first take a look at how the SES lambda handler provisions a new S3 bucket via the <a href="https://godoc.org/github.com/mweagle/Sparta#MessageBodyStorage">MessageBodyStorage</a> type:</p>

<pre><code class="language-go">
func appendSESLambda(api *sparta.API,
  lambdaFunctions []*sparta.LambdaAWSInfo)
  []*sparta.LambdaAWSInfo {

	// Our lambda function will need to be able to read from the bucket, which
	// will be handled by the S3MessageBodyBucketDecorator below
	lambdaFn, _ := sparta.NewAWSLambda(sparta.LambdaName(echoSESEvent),
		echoSESEvent,
		sparta.IAMRoleDefinition{})
	// Setup options s.t. the lambda function has time to consume the message body
	lambdaFn.Options = &amp;sparta.LambdaFunctionOptions{
		Description: &quot;&quot;,
		MemorySize:  128,
		Timeout:     10,
	}

  // Add a Permission s.t. the Lambda function automatically manages SES registration
  sesPermission := sparta.SESPermission{
    BasePermission: sparta.BasePermission{
      // SES only supports wildcard ARNs
      SourceArn: &quot;*&quot;,
    },
    InvocationType: &quot;Event&quot;,
  }
  // Store the message body
  bodyStorage, _ := sesPermission.NewMessageBodyStorageResource(&quot;Special&quot;)
  sesPermission.MessageBodyStorage = bodyStorage

</code></pre>

<p>The <code>MessageBodyStorage</code> type (and the related <a href="https://godoc.org/github.com/mweagle/Sparta#MessageBodyStorageOptions">MessageBodyStorageOptions</a> type)
cause our SESPermission handler to  add an <a href="http://docs.aws.amazon.com/ses/latest/DeveloperGuide/receiving-email-action-s3.html">S3 ReceiptRule</a>
at the head of the rules list.  This rule instructs SES to store the message body in the supplied bucket before invoking our lambda function.</p>

<p>The single parameter <code>&quot;Special&quot;</code> is an application-unique literal value that is used to create a stable CloudFormation
resource identifier so that new buckets are not created in response to stack update requests.</p>

<p>Our SES handler then adds two <a href="http://docs.aws.amazon.com/ses/latest/APIReference/API_ReceiptRule.html">ReceiptRules</a>:</p>

<pre><code class="language-go">
sesPermission.ReceiptRules = make([]sparta.ReceiptRule, 0)
sesPermission.ReceiptRules = append(sesPermission.ReceiptRules,
  sparta.ReceiptRule{
    Name:       &quot;Special&quot;,
    Recipients: []string{&quot;sombody_special@gosparta.io&quot;},
    TLSPolicy:  &quot;Optional&quot;,
  })
sesPermission.ReceiptRules = append(sesPermission.ReceiptRules,
  sparta.ReceiptRule{
    Name:       &quot;Default&quot;,
    Recipients: []string{},
    TLSPolicy:  &quot;Optional&quot;,
  })
</code></pre>

<h3 id="dynamic-iamprivilege-arn">Dynamic IAMPrivilege Arn</h3>

<p>Our lambda function is required to access the message body in the dynamically created <code>MessageBodyStorage</code> resource, but
the S3 resource Arn is only defined <em>after</em> the service is provisioned.  The solution to this is to reference the
dynamically generated <code>BucketArnAllKeys()</code> value in the <code>sparta.IAMRolePrivilege</code> initializer:</p>

<pre><code class="language-go">
// Then add the privilege to the Lambda function s.t. we can actually get at the data
lambdaFn.RoleDefinition.Privileges = append(lambdaFn.RoleDefinition.Privileges,
  sparta.IAMRolePrivilege{
    Actions:  []string{&quot;s3:GetObject&quot;, &quot;s3:HeadObject&quot;},
    Resource: sesPermission.MessageBodyStorage.BucketArnAllKeys(),
})
</code></pre>

<p>The last step is to register the <code>SESPermission</code> with the lambda info:</p>

<pre><code class="language-go">// Finally add the SES permission to the lambda function
lambdaFn.Permissions = append(lambdaFn.Permissions, sesPermission)
</code></pre>

<p>At this point we&rsquo;ve implicitly created an S3 bucket via the <code>MessageBodyStorage</code> value.  Our lambda function now needs to dynamically determine the AWS-assigned bucket name.</p>

<h3 id="dynamic-message-body-storage-discovery">Dynamic Message Body Storage Discovery</h3>

<p>Our <code>echoSESEvent</code> function needs to determine, at execution time, the <code>MessageBodyStorage</code> S3 bucket name.  This is done via <code>sparta.Discover()</code>:</p>

<pre><code class="language-go">configuration, configErr := sparta.Discover()
logger.WithFields(logrus.Fields{
  &quot;Error&quot;:         configErr,
  &quot;Configuration&quot;: configuration,
}).Info(&quot;Discovery results&quot;)

// The message bucket is an explicit `DependsOn` relationship, so it'll be in the
// resources map.  We'll find it by looking for the dependent resource with the &quot;AWS::S3::Bucket&quot; type
bucketName := &quot;&quot;
for _, eachResourceInfo := range configuration.Resources {
  if eachResourceInfo.ResourceType == &quot;AWS::S3::Bucket&quot; {
    bucketName = eachResourceInfo.Properties[&quot;Ref&quot;]
  }
}
if &quot;&quot; == bucketName {
  return nil, errors.Errorf(&quot;Failed to discover SES bucket from sparta.Discovery: %#v&quot;, configuration)
}
</code></pre>

<p>The <code>sparta.Discover()</code> function returns a <a href="https://godoc.org/github.com/mweagle/Sparta#DiscoveryInfo">DiscoveryInfo</a> structure.  This
data is published into the Lambda&rsquo;s environment variables to enable it to discover other
resources published in the same Stack.</p>

<p>The structure includes the stack&rsquo;s <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/pseudo-parameter-reference.html">Pseudo Parameters</a>
as well information about any <em>immediate</em> resource dependencies.
Eg, those that were explicitly marked as <code>DependsOn</code>.  See the <a href="/reference/discovery/">discovery documentation</a> for more details.</p>

<p>As we only have a single dependency, our discovery filter is:</p>

<pre><code class="language-go">// The message bucket is an explicit `DependsOn` relationship, so it'll be in the
// resources map.  We'll find it by looking for the dependent resource with the &quot;AWS::S3::Bucket&quot; type
bucketName := &quot;&quot;
for _, eachResourceInfo := range configuration.Resources {
  if eachResourceInfo.ResourceType == &quot;AWS::S3::Bucket&quot; {
    bucketName = eachResourceInfo.Properties[&quot;Ref&quot;]
  }
}
if &quot;&quot; == bucketName {
  return nil, errors.Errorf(&quot;Failed to discover SES bucket from sparta.Discovery: %#v&quot;, configuration)
}
</code></pre>

<h1 id="sparta-integration">#Sparta Integration</h1>

<p>The rest of <code>echoSESEvent</code> satisfies the other requirements, with a bit of help from the SES <a href="https://godoc.org/github.com/mweagle/Sparta/aws/ses">event types</a>:</p>

<pre><code class="language-go">// Get the metdata about the item...
svc := s3.New(session.New())
for _, eachRecord := range sesEvent.Records {
  logger.WithFields(logrus.Fields{
    &quot;Source&quot;:     eachRecord.SES.Mail.Source,
    &quot;MessageID&quot;:  eachRecord.SES.Mail.MessageID,
    &quot;BucketName&quot;: bucketName,
  }).Info(&quot;SES Event&quot;)

  if &quot;&quot; != bucketName {
    params := &amp;s3.HeadObjectInput{
      Bucket: aws.String(bucketName),
      Key:    aws.String(eachRecord.SES.Mail.MessageID),
    }
    resp, err := svc.HeadObject(params)
    logger.WithFields(logrus.Fields{
      &quot;Error&quot;:    err,
      &quot;Metadata&quot;: resp,
    }).Info(&quot;SES MessageBody&quot;)
  }
}
return &amp;sesEvent, nil
</code></pre>

<h1 id="wrapping-up">Wrapping Up</h1>

<p>With the <code>lambdaFn</code> fully defined, we can provide it to <code>sparta.Main()</code> and deploy our service.  The workflow below is shared by all SES-triggered lambda function:</p>

<ul>
<li>Define the lambda function (<code>echoSESEvent</code>).</li>
<li>If needed, create the required <a href="https://godoc.org/github.com/mweagle/Sparta*IAMRoleDefinition">IAMRoleDefinition</a> with appropriate privileges if the lambda function accesses other AWS services.</li>
<li>Provide the lambda function &amp; IAMRoleDefinition to <code>sparta.NewAWSLambda()</code></li>
<li>Add the necessary <a href="https://godoc.org/github.com/mweagle/Sparta#LambdaAWSInfo">Permissions</a> to the <code>LambdaAWSInfo</code> struct so that the lambda function is triggered.</li>
</ul>

<p>Additionally, if the SES handler needs to access the raw email message body:</p>

<ul>
<li>Create a new <code>sesPermission.NewMessageBodyStorageResource(&quot;Special&quot;)</code> value to store the message body</li>
<li>Assign the value to the <code>sesPermission.MessageBodyStorage</code> field</li>
<li>If your lambda function needs to consume the message body, add an entry to <code>sesPermission.[]IAMPrivilege</code> that includes the <code>sesPermission.MessageBodyStorage.BucketArnAllKeys()</code> Arn</li>
<li>In your <strong>go</strong> lambda function definition, discover the S3 bucketname via <code>sparta.Discover()</code></li>
</ul>

<h1 id="notes">Notes</h1>

<ul>
<li>The SES message (including headers) is stored in the <a href="http://stackoverflow.com/questions/33549327/what-is-the-format-of-the-aws-ses-body-stored-in-s3">raw format</a></li>
<li>More on Immutable Infrastructure:

<ul>
<li><a href="https://www.subbu.org/blog/2014/10/automate-everything-but-dont-ignore-drift">Subbu - Automate Everything</a></li>
<li><a href="http://chadfowler.com/2013/06/23/immutable-deployments.html">Chad Fowler - Immutable Deployments</a></li>
<li><a href="http://www.thecloudcast.net/2015/09/the-cloudcast-213-what-is-immutable.html">The Cloudcast - What is Immutable Infrastructure</a></li>
<li><a href="http://thenewstack.io/a-brief-look-at-immutable-infrastructure-and-why-it-is-such-a-quest/">The New Stack</a></li>
</ul></li>
</ul>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/reference/eventsources/s3/" title="S3"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/reference/eventsources/sns/" title="SNS" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1559541734"></script>
    <script src="/js/perfect-scrollbar.min.js?1559541734"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1559541734"></script>
    <script src="/js/jquery.sticky.js?1559541734"></script>
    <script src="/js/featherlight.min.js?1559541734"></script>
    <script src="/js/html5shiv-printshiv.min.js?1559541734"></script>
    <script src="/js/highlight.pack.js?1559541734"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1559541734"></script>
    <script src="/js/learn.js?1559541734"></script>
    <script src="/js/hugo-learn.js?1559541734"></script>

    <link href="/mermaid/mermaid.css?1559541734" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1559541734"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70794971-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70794971-2');
</script>
  </body>
</html>

