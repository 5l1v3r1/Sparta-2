<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.52" />
    <meta name="description" content="Sparta - AWS Lambda Microservices">
<meta name="author" content="Matt Weagle">

    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title>Fargate :: Sparta - AWS Lambda Microservices</title>

    
    <link href="/css/nucleus.css?1549032746" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1549032746" rel="stylesheet">
    <link href="/css/hybrid.css?1549032746" rel="stylesheet">
    <link href="/css/featherlight.min.css?1549032746" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1549032746" rel="stylesheet">
    <link href="/css/auto-complete.css?1549032746" rel="stylesheet">
    <link href="/css/theme.css?1549032746" rel="stylesheet">
    <link href="/css/hugo-theme.css?1549032746" rel="stylesheet">
    
      <link href="/css/theme-sparta.css?1549032746" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1549032746"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
<style type="text/css">
pre {
    padding: 2px;
}
</style>


  </head>
  <body class="" data-url="/reference/step/fargate/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/"><img src="/images/SpartaLogoNoDomain.png" height="50%" width="50%"/></a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1549032746"></script>
<script type="text/javascript" src="/js/auto-complete.js?1549032746"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1549032746"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/concepts/">
          Concepts
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/example_service/" title="Example Service" class="dd-item 
        
        
        
        ">
      <a href="/example_service/">
          Example Service
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/example_service/step1/" title="Overview" class="dd-item ">
        <a href="/example_service/step1/">
        Overview
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/example_service/step2/" title="Details" class="dd-item ">
        <a href="/example_service/step2/">
        Details
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/cli_options/" title="CLI Options" class="dd-item 
        
        
        
        ">
      <a href="/cli_options/">
          CLI Options
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/reference/" title="Reference" class="dd-item 
        parent
        
        
        ">
      <a href="/reference/">
          Reference
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/reference/apigateway/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/apigateway/">
          <b>API Gateway</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/echo_event/" title="Echo" class="dd-item ">
        <a href="/reference/apigateway/echo_event/">
        Echo
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/request_params/" title="Request Parameters" class="dd-item ">
        <a href="/reference/apigateway/request_params/">
        Request Parameters
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/context/" title="Request Context" class="dd-item ">
        <a href="/reference/apigateway/context/">
        Request Context
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/cors/" title="CORS" class="dd-item ">
        <a href="/reference/apigateway/cors/">
        CORS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/slack/" title="Slack SlashCommand" class="dd-item ">
        <a href="/reference/apigateway/slack/">
        Slack SlashCommand
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/apigateway/s3site/" title="S3 Sites with CORS" class="dd-item ">
        <a href="/reference/apigateway/s3site/">
        S3 Sites with CORS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/eventsources/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/eventsources/">
          <b>Event Sources</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/codecommit/" title="CodeCommit" class="dd-item ">
        <a href="/reference/eventsources/codecommit/">
        CodeCommit
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cloudformation/" title="CloudFormation" class="dd-item ">
        <a href="/reference/eventsources/cloudformation/">
        CloudFormation
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cloudwatchevents/" title="CloudWatch Events" class="dd-item ">
        <a href="/reference/eventsources/cloudwatchevents/">
        CloudWatch Events
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cloudwatchlogs/" title="CloudWatch Logs" class="dd-item ">
        <a href="/reference/eventsources/cloudwatchlogs/">
        CloudWatch Logs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/cognito/" title="Cognito" class="dd-item ">
        <a href="/reference/eventsources/cognito/">
        Cognito
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/dynamodb/" title="DynamoDB" class="dd-item ">
        <a href="/reference/eventsources/dynamodb/">
        DynamoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/kinesis/" title="Kinesis" class="dd-item ">
        <a href="/reference/eventsources/kinesis/">
        Kinesis
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/s3/" title="S3" class="dd-item ">
        <a href="/reference/eventsources/s3/">
        S3
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/ses/" title="SES" class="dd-item ">
        <a href="/reference/eventsources/ses/">
        SES
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/sns/" title="SNS" class="dd-item ">
        <a href="/reference/eventsources/sns/">
        SNS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/eventsources/sqs/" title="SQS" class="dd-item ">
        <a href="/reference/eventsources/sqs/">
        SQS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/archetypes/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/archetypes/">
          <b>Archetype Constructors</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/codecommit/" title="CodeCommit" class="dd-item ">
        <a href="/reference/archetypes/codecommit/">
        CodeCommit
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/cloudwatch/" title="CloudWatch" class="dd-item ">
        <a href="/reference/archetypes/cloudwatch/">
        CloudWatch
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/dynamodb/" title="DynamoDB" class="dd-item ">
        <a href="/reference/archetypes/dynamodb/">
        DynamoDB
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/kinesis/" title="Kinesis" class="dd-item ">
        <a href="/reference/archetypes/kinesis/">
        Kinesis
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/rest/" title="REST Service" class="dd-item ">
        <a href="/reference/archetypes/rest/">
        REST Service
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/s3/" title="S3" class="dd-item ">
        <a href="/reference/archetypes/s3/">
        S3
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/archetypes/sns/" title="SNS" class="dd-item ">
        <a href="/reference/archetypes/sns/">
        SNS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/decorators/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/decorators/">
          <b>Build-Time Decorators</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/cloudfront_distribution/" title="CloudFront Distribution" class="dd-item ">
        <a href="/reference/decorators/cloudfront_distribution/">
        CloudFront Distribution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/lambda_versioning/" title="Lambda Versioning Decorator" class="dd-item ">
        <a href="/reference/decorators/lambda_versioning/">
        Lambda Versioning Decorator
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/publish_outputs/" title="Publishing Outputs" class="dd-item ">
        <a href="/reference/decorators/publish_outputs/">
        Publishing Outputs
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/s3_artifact_publisher/" title="S3 Artifact Publisher" class="dd-item ">
        <a href="/reference/decorators/s3_artifact_publisher/">
        S3 Artifact Publisher
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/decorators/dynamic_infrastructure/" title="Dynamic Infrastructure" class="dd-item ">
        <a href="/reference/decorators/dynamic_infrastructure/">
        Dynamic Infrastructure
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/interceptors/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/interceptors/">
          <b>Runtime Interceptors</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/interceptors/xray_interceptor/" title="XRayInterceptor" class="dd-item ">
        <a href="/reference/interceptors/xray_interceptor/">
        XRayInterceptor
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/application/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/application/">
          <b>Application Customization</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_commands/" title="Custom Commands" class="dd-item ">
        <a href="/reference/application/custom_commands/">
        Custom Commands
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_flags/" title="Custom Flags" class="dd-item ">
        <a href="/reference/application/custom_flags/">
        Custom Flags
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/environments/" title="Managing Environments" class="dd-item ">
        <a href="/reference/application/environments/">
        Managing Environments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_lambda_resources/" title="CloudFormation Resources" class="dd-item ">
        <a href="/reference/application/custom_lambda_resources/">
        CloudFormation Resources
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/application/custom_resources/" title="Custom Resources" class="dd-item ">
        <a href="/reference/application/custom_resources/">
        Custom Resources
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/step/" title="" class="dd-item 
        parent
        
        
        ">
      <a href="/reference/step/">
          <b>Step Functions</b>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/step/lambda/" title="Lambda" class="dd-item ">
        <a href="/reference/step/lambda/">
        Lambda
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/fargate/" title="Fargate" class="dd-item active">
        <a href="/reference/step/fargate/">
        Fargate
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/step/services/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/step/services/">
          <b>Service Integrations</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/batch/" title="AWS Batch" class="dd-item ">
        <a href="/reference/step/services/batch/">
        AWS Batch
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/fargate/" title="AWS Fargate" class="dd-item ">
        <a href="/reference/step/services/fargate/">
        AWS Fargate
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/glue/" title="AWS Glue" class="dd-item ">
        <a href="/reference/step/services/glue/">
        AWS Glue
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/dynamodb/" title="Amazon DynamoDb" class="dd-item ">
        <a href="/reference/step/services/dynamodb/">
        Amazon DynamoDb
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/sns/" title="Amazon SNS" class="dd-item ">
        <a href="/reference/step/services/sns/">
        Amazon SNS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/sqs/" title="Amazon SQS" class="dd-item ">
        <a href="/reference/step/services/sqs/">
        Amazon SQS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/step/services/sagemaker/" title="Amazon SageMaker" class="dd-item ">
        <a href="/reference/step/services/sagemaker/">
        Amazon SageMaker
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/discovery/" title="Discovery Service" class="dd-item ">
        <a href="/reference/discovery/">
        Discovery Service
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/docker/" title="Docker" class="dd-item ">
        <a href="/reference/docker/">
        Docker
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/hybrid_topologies/" title="Hybrid Topologies" class="dd-item ">
        <a href="/reference/hybrid_topologies/">
        Hybrid Topologies
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/reference/operations/" title="" class="dd-item 
        
        
        
        ">
      <a href="/reference/operations/">
          <b>Operations</b>
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/magefile/" title="Magefiles" class="dd-item ">
        <a href="/reference/operations/magefile/">
        Magefiles
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/cloudwatch_alarms/" title="CloudWatch Alarms" class="dd-item ">
        <a href="/reference/operations/cloudwatch_alarms/">
        CloudWatch Alarms
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/cloudwatch_dashboard/" title="CloudWatch Dashboard" class="dd-item ">
        <a href="/reference/operations/cloudwatch_dashboard/">
        CloudWatch Dashboard
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/codedeploy_service_update/" title="CodeDeploy Service Update" class="dd-item ">
        <a href="/reference/operations/codedeploy_service_update/">
        CodeDeploy Service Update
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/cicd/" title="CI/CD" class="dd-item ">
        <a href="/reference/operations/cicd/">
        CI/CD
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/deployment_strategies/" title="Deployment Strategies" class="dd-item ">
        <a href="/reference/operations/deployment_strategies/">
        Deployment Strategies
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/metrics_publisher/" title="Metrics Publisher" class="dd-item ">
        <a href="/reference/operations/metrics_publisher/">
        Metrics Publisher
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/operations/profiling/" title="Profiling" class="dd-item ">
        <a href="/reference/operations/profiling/">
        Profiling
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/testing/" title="Testing" class="dd-item ">
        <a href="/reference/testing/">
        Testing
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/supporting_packages/" title="Supporting Packages" class="dd-item ">
        <a href="/reference/supporting_packages/">
        Supporting Packages
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/limitations/" title="Limitations" class="dd-item ">
        <a href="/reference/limitations/">
        Limitations
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/reference/faq/" title="FAQ" class="dd-item ">
        <a href="/reference/faq/">
        FAQ
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/presentations/" title="Presentations" class="dd-item 
        
        
        
        ">
      <a href="/presentations/">
          Presentations
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/credits/" title="Credits" class="dd-item 
        
        
        
        ">
      <a href="/credits/">
          Credits
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/meta/" title="_Meta" class="dd-item 
        
        
        
        ">
      <a href="/meta/">
          _Meta
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/mweagle/Sparta"><i class='fab fa-fw fa-github'></i> Github repo</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/mweagle?utf8=%E2%9C%93&amp;tab=repositories&amp;q=Sparta&amp;type=&amp;language="><i class='fas fa-fw fa-camera'></i> Showcases</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://github.com/mweagle/Sparta/blob/master/CHANGES.md"><i class='fas fa-fw fa-signal'></i> Release History</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      
  Build: <a target="_blank" href="https://github.com/mweagle/Sparta/commit/9d28fed5">9d28fed5</a><p/>
  Date: 2018-12-16 19:04:57 -0800 PST


<p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/mweagle/Sparta/tree/docs/content/reference/step/fargate.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'></a> > <a href='/reference/'>Reference</a> > <a href='/reference/step/'></a> > Fargate
          
         
          
         
          
         
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#task-awareness">Task Awareness</a></li>
<li><a href="#package">Package</a></li>
<li><a href="#push-to-ecr">Push to ECR</a></li>
<li><a href="#state-machine">State Machine</a></li>
<li><a href="#fargate-cluster">Fargate Cluster</a>
<ul>
<li><a href="#ecs-task-definition">ECS Task Definition</a></li>
</ul></li>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#provisioning">Provisioning</a></li>
<li><a href="#result">Result</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Fargate</h1>
          

        




<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Teaching people to do serverless is hard. It&#39;s far less about teaching someone about FaaS and far more about getting people into the right mindset. It is not about technology, or at least, it&#39;s not about doing technology</p>&mdash; Paul Johnston (@PaulDJohnston) <a href="https://twitter.com/PaulDJohnston/status/1073347546553217024?ref_src=twsrc%5Etfw">December 13, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>While Serverless and FaaS are often used interchangeably, there are types of
workloads that are more challenging to move to FaaS. Perhaps due to third
party libraries, latency, or storage requirements, the FaaS model
isn&rsquo;t an ideal fit. An example that is commonly provided is the need
to run <a href="https://www.ffmpeg.org/">ffmpeg</a>.</p>

<p>To benefit from the serverless model in these cases, Sparta provides
the ability to leverage the <a href="https://aws.amazon.com/fargate">Fargate</a> service
to run Containers without needing to manage servers.</p>

<p>There are several steps to <em>Fargate-ifying</em> your application and Sparta exposes
functions and hooks to make that operation scoped to a <code>provision</code> operation.</p>

<p>Those steps include:</p>

<ol>
<li>Make the application Task-aware</li>
<li>Package your application in a Docker image</li>
<li>Push the Docker image to <a href="https://aws.amazon.com/ecr/">Amazon ECR</a></li>
<li>Reference the ECR URL in a Fargate Task</li>
<li>Provision an ECS cluster that hosts the Task</li>
</ol>

<p>This overview is based on the <a href="https://github.com/mweagle/SpartaStepServicefull">SpartaStepServicefull</a>
project. The implementation uses a combination of <a href="https://godoc.org/github.com/mweagle/Sparta#ServiceDecoratorHookHandler">ServiceDecoratorHookHandlers</a>
to achieve the end result.</p>

<p>Please see <a href="https://github.com/mweagle/SpartaStepServicefull/blob/master/bootstrap/servicefull_build.go">servicefull_build.go</a>
for the most up-to-date version of code samples.</p>

<h2 id="task-awareness">Task Awareness</h2>

<p>The first step is to provide an opportunity for our application to behave
differently when run as a Fargate task. To do this we add a new
application subcommand option that augments the standard <code>Main</code> behavior:</p>

<pre><code class="language-go">// Add a hook to do something
fargateTask := &amp;cobra.Command{
  Use:   &quot;fargateTask&quot;,
  Short: &quot;Sample Fargate task&quot;,
  Long:  `Sample Fargate task that simply logs a message&quot;`,
  RunE: func(cmd *cobra.Command, args []string) error {
    fmt.Printf(&quot;Insert your Fargate code here! 🎉&quot;)
    return nil
  },
}
// Register the command with the Sparta root dispatcher. This
// command `fargateTask` matches the command line option in the
// Dockerfile that is used to build the image.
sparta.CommandLineOptions.Root.AddCommand(fargateTask)
</code></pre>

<p>This subcommand is defined in the <a href="https://github.com/mweagle/SpartaStepServicefull/blob/master/bootstrap/servicefull_task.go">servicefull_task</a>
file. Note that the file uses <code>go</code> <a href="https://dave.cheney.net/2013/10/12/how-to-use-conditional-compilation-with-the-go-build-tool">build tags</a>
so that the new <strong>fargateTask</strong> subcommand is only available when the
build target includes the <em>lambdaBinary</em> flag:</p>

<pre><code class="language-go">// +build lambdabinary

package bootstrap
</code></pre>

<p>We can now package our Task-aware executable and deploy it to the cloud.</p>

<h2 id="package">Package</h2>

<p>The first step is to create a version of your application that
can support a Fargate task. This is done in the <code>ecrImageBuilderDecorator</code>
function which delegates the compiling and image creation to Sparta:</p>

<pre><code class="language-go">// Always build the image
buildErr := spartaDocker.BuildDockerImage(serviceName,
  &quot;&quot;,
  dockerTags,
  logger)
</code></pre>

<p>The second empty argument above is an optional <em>Dockerfile</em> path. The sample
project uses the default <em>Dockerfile</em> filename and defines that at the root
of the repository. The full <em>Dockerfile</em> is:</p>

<pre><code class="language-docker">FROM alpine:3.8
RUN apk update &amp;&amp; apk add ca-certificates &amp;&amp; rm -rf /var/cache/apk/*

# Sparta provides the SPARTA_DOCKER_BINARY argument to the builder
# in order to embed the binary.
# Ref: https://docs.docker.com/engine/reference/builder/
ARG SPARTA_DOCKER_BINARY
ADD $SPARTA_DOCKER_BINARY /SpartaServicefull
CMD [&quot;/SpartaServicefull&quot;, &quot;fargateTask&quot;]
</code></pre>

<p>The <code>BuildDockerImage</code> function supplies the transient binary executable
path to docker via the <strong>SPARTA_DOCKER_BINARY</strong> <a href="https://docs.docker.com/engine/reference/commandline/build/#set-build-time-variables---build-arg">ARG</a>
value.</p>

<p>The <code>CMD</code> instruction includes our previously registered <strong>fargateTask</strong>
subcommand name to invoke the Task-appropriate codepath at runtime.</p>

<p>The log output includes the docker build info:</p>

<pre><code>INFO[0002] Calling WorkflowHook
  ServiceDecoratorHook=github.com/mweagle/SpartaStepServicefull/bootstrap.ecrImageBuilderDecorator.func1
  WorkflowHookContext=&quot;map[]&quot;
INFO[0002] Docker version 18.09.0, build 4d60db4
INFO[0002] Running `go generate`
INFO[0002] Compiling binary
  Name=ServicefulStepFunction-1544976454011339000-docker.lambda.amd64
INFO[0003] Creating Docker image
  Tags=&quot;map[servicefulstepfunction:adc67a77aef22b6dab9c6156d13853e2cfe06488.1544976453]&quot;
 NFO[0004] Sending build context to Docker daemon  35.43MB
INFO[0004] Step 1/5 : FROM alpine:3.8
INFO[0004]  ---&gt; 196d12cf6ab1
INFO[0004] Step 2/5 : RUN apk update &amp;&amp; apk add ca-certificates &amp;&amp; rm -rf /var/cache/apk/*
INFO[0004]  ---&gt; Using cache
INFO[0004]  ---&gt; 99402375b7f2
INFO[0004] Step 3/5 : ARG SPARTA_DOCKER_BINARY
INFO[0004]  ---&gt; Using cache
INFO[0004]  ---&gt; a44d27522c40
INFO[0004] Step 4/5 : ADD $SPARTA_DOCKER_BINARY /SpartaServicefull
INFO[0005]  ---&gt; 87ffd10e9901
INFO[0005] Step 5/5 : CMD [&quot;/SpartaServicefull&quot;, &quot;fargateTask&quot;]
INFO[0005]  ---&gt; Running in 0a3b503201c7
INFO[0005] Removing intermediate container 0a3b503201c7
INFO[0005]  ---&gt; 7cb1b2261a92
INFO[0005] Successfully built 7cb1b2261a92
INFO[0005] Successfully tagged
  servicefulstepfunction:adc67a77aef22b6dab9c6156d13853e2cfe06488.1544976453
</code></pre>

<h2 id="push-to-ecr">Push to ECR</h2>

<p>The next step is to push the locally built image to the Elastic
Container Registry. The push will return either the ECR URL
which will be used as Fargate Task <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-ecs-taskdefinition-containerdefinitions.html#cfn-ecs-taskdefinition-containerdefinition-image">image</a>
property or an error:</p>

<pre><code class="language-go">// Push the image to ECR &amp; store the URL s.t. we can properly annotate
// the CloudFormation template
ecrURLPush, pushImageErr := spartaDocker.PushDockerImageToECR(buildTag,
  ecrRepositoryName,
  awsSession,
  logger)
</code></pre>

<p>The ECR push URL is stored in the <code>context</code> variable so that a downstream
Fargate cluster builder knows the image to use:</p>

<pre><code class="language-go">context[contextKeyImageURL] = ecrURLPush
</code></pre>

<h2 id="state-machine">State Machine</h2>

<p>The Step Function definition indirectly references the Fargate
Task via task specific <a href="https://docs.aws.amazon.com/step-functions/latest/dg/connectors-ecs.html">parameters</a>:</p>

<pre><code class="language-go">fargateParams := spartaStep.FargateTaskParameters{
  LaunchType:     &quot;FARGATE&quot;,
  Cluster:        gocf.Ref(resourceNames.ECSCluster).String(),
  TaskDefinition: gocf.Ref(resourceNames.ECSTaskDefinition).String(),
  NetworkConfiguration: &amp;spartaStep.FargateNetworkConfiguration{
    AWSVPCConfiguration: &amp;gocf.ECSServiceAwsVPCConfiguration{
      Subnets: gocf.StringList(
        gocf.Ref(resourceNames.PublicSubnetAzs[0]).String(),
        gocf.Ref(resourceNames.PublicSubnetAzs[1]).String(),
      ),
      AssignPublicIP: gocf.String(&quot;ENABLED&quot;),
    },
  },
}
fargateState := spartaStep.NewFargateTaskState(&quot;Run Fargate Task&quot;, fargateParams)
</code></pre>

<p>The <strong>ECSCluster</strong> and <strong>ECSTaskDefinition</strong> are resources that are provisioned
by the <code>fargateClusterDecorator</code> decorator function.</p>

<h2 id="fargate-cluster">Fargate Cluster</h2>

<p>The final step is to provision the ECS cluster that supports the Fargate
task. This is encapsulated in the <code>fargateClusterDecorator</code> which creates
the required set of CloudFormation resources. The set of CloudFormation
resource names is represented in the <code>stackResourceNames</code> struct:</p>

<pre><code class="language-go">type stackResourceNames struct {
  StepFunction              string
  SNSTopic                  string
  ECSCluster                string
  ECSRunTaskRole            string
  ECSTaskDefinition         string
  ECSTaskDefinitionLogGroup string
  ECSTaskDefinitionRole     string
  VPC                       string
  InternetGateway           string
  AttachGateway             string
  RouteViaIgw               string
  PublicRouteViaIgw         string
  ECSSecurityGroup          string
  PublicSubnetAzs           []string
}
</code></pre>

<p>The <a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/task_definitions.html">ECS Task Definition</a>
is of particular interest and is where the inline created <strong>ECR_URL</strong> is used to
define a FARGATE task.</p>

<h3 id="ecs-task-definition">ECS Task Definition</h3>

<pre><code class="language-go">imageURL, _ := context[contextKeyImageURL].(string)
if imageURL == &quot;&quot; {
  return errors.Errorf(&quot;Failed to get image URL from context with key %s&quot;,
    contextKeyImageURL)
}
...
// Create the ECS task definition
ecsTaskDefinition := &amp;gocf.ECSTaskDefinition{
  ExecutionRoleArn:        gocf.GetAtt(resourceNames.ECSTaskDefinitionRole, &quot;Arn&quot;),
  RequiresCompatibilities: gocf.StringList(gocf.String(&quot;FARGATE&quot;)),
  CPU:                     gocf.String(&quot;256&quot;),
  Memory:                  gocf.String(&quot;512&quot;),
  NetworkMode:             gocf.String(&quot;awsvpc&quot;),
  ContainerDefinitions: &amp;gocf.ECSTaskDefinitionContainerDefinitionList{
    gocf.ECSTaskDefinitionContainerDefinition{
      Image:     gocf.String(imageURL),
      Name:      gocf.String(&quot;sparta-servicefull&quot;),
      Essential: gocf.Bool(true),
      LogConfiguration: &amp;gocf.ECSTaskDefinitionLogConfiguration{
        LogDriver: gocf.String(&quot;awslogs&quot;),
        // Options Ref: https://docs.aws.amazon.com/AmazonECS/latest/developerguide/AWS_Fargate.html
        Options: map[string]interface{}{
          &quot;awslogs-region&quot;: gocf.Ref(&quot;AWS::Region&quot;),
          &quot;awslogs-group&quot;: strings.Join([]string{&quot;&quot;,
            sparta.ProperName,
            serviceName}, &quot;/&quot;),
          &quot;awslogs-stream-prefix&quot;: serviceName,
          &quot;awslogs-create-group&quot;:  &quot;true&quot;,
        },
      },
    },
  },
}
</code></pre>

<h2 id="configuration">Configuration</h2>

<p>The final step is to provide the three decorators to the
<a href="https://godoc.org/github.com/mweagle/Sparta#WorkflowHooks">WorkflowHooks</a> structure:</p>

<pre><code class="language-go">workflowHooks := &amp;sparta.WorkflowHooks{
  ServiceDecorators: []sparta.ServiceDecoratorHookHandler{
    ecrImageBuilderDecorator(&quot;spartadocker&quot;),
    // Then build the state machine
    stateMachine.StateMachineDecorator(),
    // Then the ECS cluster that supports the Fargate task
    fargateClusterDecorator(resourceNames),
  },
}
</code></pre>

<h2 id="provisioning">Provisioning</h2>

<p>The provisioning workflow for this service is the same as a Lambda-based one:</p>

<pre><code class="language-shell">$ go run main.provision --s3Bucket $MY_S3_BUCKET
</code></pre>

<p>Output:</p>

<pre><code>INFO[0000] ════════════════════════════════════════════════
INFO[0000] ╔═╗╔═╗╔═╗╦═╗╔╦╗╔═╗   Version : 1.8.0
INFO[0000] ╚═╗╠═╝╠═╣╠╦╝ ║ ╠═╣   SHA     : 597d3ba
INFO[0000] ╚═╝╩  ╩ ╩╩╚═ ╩ ╩ ╩   Go      : go1.11.1
INFO[0000] ════════════════════════════════════════════════
INFO[0000] Service: ServicefulStepFunction
  LinkFlags= Option=provision UTC=&quot;2018-12-16T16:07:31Z&quot;
INFO[0000] ════════════════════════════════════════════════
INFO[0000] Using `git` SHA for StampedBuildID
  Command=&quot;git rev-parse HEAD&quot; SHA=adc67a77aef22b6dab9c6156d13853e2cfe06488
INFO[0000] Provisioning service
  BuildID=adc67a77aef22b6dab9c6156d13853e2cfe06488
  CodePipelineTrigger=
  InPlaceUpdates=false
  NOOP=false Tags=
WARN[0000] No lambda functions provided to Sparta.Provision()
INFO[0000] Verifying IAM Lambda execution roles
INFO[0000] IAM roles verified                            Count=0
</code></pre>

<h2 id="result">Result</h2>

<p>The end result is a Step function that uses our <code>go</code> binary, Step functions,
and SNS rather than Lambda functions:</p>

<p><img src="https://raw.githubusercontent.com/mweagle/Sparta/master/docs_source/static/site/1.8.0/step_functions_fargate.jpg" alt="Step Function" title="Step Function" /></p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/reference/step/lambda/" title="Lambda"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/reference/step/services/" title="" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1549032746"></script>
    <script src="/js/perfect-scrollbar.min.js?1549032746"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1549032746"></script>
    <script src="/js/jquery.sticky.js?1549032746"></script>
    <script src="/js/featherlight.min.js?1549032746"></script>
    <script src="/js/html5shiv-printshiv.min.js?1549032746"></script>
    <script src="/js/highlight.pack.js?1549032746"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1549032746"></script>
    <script src="/js/learn.js?1549032746"></script>
    <script src="/js/hugo-learn.js?1549032746"></script>

    <link href="/mermaid/mermaid.css?1549032746" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1549032746"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70794971-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70794971-2');
</script>
  </body>
</html>

