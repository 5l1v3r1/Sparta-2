<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Event Source - DynamoDB - Sparta</title>
    <meta name="generator" content="Hugo 0.31.1" />

    
    <meta name="description" content="Sparta - Go framework for AWS Lambda">
    
    <link rel="canonical" href="http://gosparta.io/docs/eventsources/dynamodb/">
    
    <meta name="author" content="Matt Weagle">
    

    <meta property="og:url" content="http://gosparta.io/docs/eventsources/dynamodb/">
    <meta property="og:title" content="Sparta">
    <meta property="og:image" content="http://gosparta.io/images/SpartaHelmet.png">
    <meta name="apple-mobile-web-app-title" content="Sparta">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="http://gosparta.io/favicons/favicon.ico">
    <link rel="icon" type="image/x-icon" href="http://gosparta.io/favicons/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('http://gosparta.io/fonts/icon.eot');
        src: url('http://gosparta.io/fonts/icon.eot')
               format('embedded-opentype'),
             url('http://gosparta.io/fonts/icon.woff')
               format('woff'),
             url('http://gosparta.io/fonts/icon.ttf')
               format('truetype'),
             url('http://gosparta.io/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="http://gosparta.io/stylesheets/application.css">
    <link rel="stylesheet" href="http://gosparta.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="http://gosparta.io/stylesheets/palettes.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open%20Sans:400,700|Source&#43;Code&#43;Pro">
    <style>
      body, input {
        font-family: 'Open Sans', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Source Code Pro', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="http://gosparta.io/css/sparta.css">
    
    <link rel="stylesheet" href="http://gosparta.io/external/mermaid_dist/mermaid.css">
    
    <link rel="stylesheet" href="http://gosparta.io/external/font-awesome-4.7.0/css/font-awesome.min.css">
    
    <script src="http://gosparta.io/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-grey palette-accent-indigo">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Event Source - DynamoDB
      </div>
    </div>

    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/mweagle" title="@mweagle on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/mweagle" title="@mweagle on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/mweagle/Sparta" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="http://gosparta.io/images/SpartaHelmet.png">
        </div>
      
      <div class="name">
        <strong>Sparta <span class="version">1.0.0</span></strong>
        
          <br>
          mweagle/Sparta
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/mweagle/Sparta/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/mweagle/Sparta/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Sparta" href="http://gosparta.io/">
	
	Sparta
</a>



  
</li>



<li>
  
    



<a  title="Overview" href="http://gosparta.io/docs/overview">
	
	Overview
</a>



  
</li>



<li>
  
    



<a  title="Sample Service" href="http://gosparta.io/docs/intro_example/intro">
	
	Sample Service
</a>



  
</li>



<li>
  
    <span class="section">Documentation</span>
    <ul>
      
        
        



<a  title="Event Sources" href="http://gosparta.io/docs/eventsources/eventsources/">
	
	Event Sources
</a>



      
        
        



<a  title="API Gateway" href="http://gosparta.io/docs/apigateway/apigateway/">
	
	API Gateway
</a>



      
        
        



<a  title="S3 Sites with CORS" href="http://gosparta.io/docs/s3site/">
	
	S3 Sites with CORS
</a>



      
        
        



<a  title="Application Customization" href="http://gosparta.io/docs/application/application/">
	
	Application Customization
</a>



      
        
        



<a  title="Custom Resources" href="http://gosparta.io/docs/custom_resources/">
	
	Custom Resources
</a>



      
        
        



<a  title="Discovery Service" href="http://gosparta.io/docs/discovery/">
	
	Discovery Service
</a>



      
        
        



<a  title="Dynamic Infrastructure" href="http://gosparta.io/docs/dynamic_infrastructure/">
	
	Dynamic Infrastructure
</a>



      
        
        



<a  title="Python/cgo Support" href="http://gosparta.io/docs/cgo/">
	
	Python/cgo Support
</a>



      
        
        



<a  title="Docker" href="http://gosparta.io/docs/docker/">
	
	Docker
</a>



      
        
        



<a  title="Step Functions" href="http://gosparta.io/docs/step_functions/">
	
	Step Functions
</a>



      
        
        



<a  title="CI/CD" href="http://gosparta.io/docs/cicd/">
	
	CI/CD
</a>



      
        
        



<a  title="Local Testing" href="http://gosparta.io/docs/local_testing/">
	
	Local Testing
</a>



      
        
        



<a  title="Profiling" href="http://gosparta.io/docs/profiling/">
	
	Profiling
</a>



      
        
        



<a  title="Hybrid Topologies" href="http://gosparta.io/docs/hybrid_topologies/">
	
	Hybrid Topologies
</a>



      
    </ul>
  
</li>



<li>
  
    



<a  title="Presentations" href="http://gosparta.io/docs/presentations">
	
	Presentations
</a>



  
</li>



<li>
  
    



<a  title="Limitations" href="http://gosparta.io/docs/limitations">
	
	Limitations
</a>



  
</li>



<li>
  
    



<a  title="FAQ" href="http://gosparta.io/docs/faq">
	
	FAQ
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          
          <li>
            <a href="https://twitter.com/mweagle" target="_blank" title="@mweagle on Twitter">
              @mweagle on Twitter
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/mweagle" target="_blank" title="@mweagle on GitHub">
              @mweagle on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:mweagle@gmail.com" title="Email of mweagle@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Event Source - DynamoDB </h1>

			

<p>In this section we&rsquo;ll walkthrough how to trigger your lambda function in response to DynamoDB stream events.  This overview is based on the <a href="https://github.com/mweagle/SpartaApplication">SpartaApplication</a> sample code if you&rsquo;d rather jump to the end result.</p>

<h1 id="goal">Goal</h1>

<p>Assume that we&rsquo;re given a DynamoDB stream.  See <a href="http://localhost:1313/docs/eventsources/dynamodb/#creatingDynamoDBStream:d680e8a854a7cbad6d490c445cba2eba">below</a> for details on how to create the stream.  We&rsquo;ve been asked to write a lambda function that logs when operations are performed to the table so that we can perform offline analysis.</p>

<h1 id="getting-started">Getting Started</h1>

<p>We&rsquo;ll start with an empty lambda function and build up the needed functionality.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">func</span> <span style="color:#000">echoDynamoDBEvent</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">w</span> <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ResponseWriter</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Request</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">{</span>
	<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Context</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Value</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sparta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ContextKeyLogger</span><span style="color:#000;font-weight:bold">).(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">logrus</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Logger</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000">lambdaContext</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">_</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Context</span><span style="color:#000;font-weight:bold">().</span><span style="color:#000">Value</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">sparta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">ContextKeyLambdaContext</span><span style="color:#000;font-weight:bold">).(</span><span style="color:#ce5c00;font-weight:bold">*</span><span style="color:#000">sparta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">LambdaContext</span><span style="color:#000;font-weight:bold">)</span>
	<span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithFields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logrus</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Fields</span><span style="color:#000;font-weight:bold">{</span>
		<span style="color:#4e9a06">&#34;RequestID&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">lambdaContext</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">AWSRequestID</span><span style="color:#000;font-weight:bold">,</span>
	<span style="color:#000;font-weight:bold">}).</span><span style="color:#000">Info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Request received&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></div>

<h1 id="a-href-hahahugoshortcode-2hbhb-unmarshalling-the-dynamodb-event-a"><a href="#unmarshalDynamoDBEvent">Unmarshalling the DynamoDB Event</a></h1>

<p>Since the <code>echoDynamoDBEvent</code> is expected to be triggered by DynamoDB events, we will unmarshal the <code>req.Body</code> data into an DynamoDB-specific event provided by Sparta via:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">decoder</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">json</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewDecoder</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">r</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Body</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">defer</span> <span style="color:#000">r</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Body</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Close</span><span style="color:#000;font-weight:bold">()</span>
<span style="color:#204a87;font-weight:bold">var</span> <span style="color:#000">lambdaEvent</span> <span style="color:#000">spartaDynamoDB</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Event</span>
<span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">decoder</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Decode</span><span style="color:#000;font-weight:bold">(</span><span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">lambdaEvent</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">err</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#204a87;font-weight:bold">nil</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Failed to unmarshal event data: &#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">())</span>
  <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">w</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">err</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Error</span><span style="color:#000;font-weight:bold">(),</span> <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">StatusInternalServerError</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></div>

<p>DynamoDB events are delivered in batches, via lists of <a href="https://godoc.org/github.com/mweagle/Sparta/aws/dynamodb#EventRecord">EventRecords</a>, so we&rsquo;ll need to process each record.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">_</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">eachRecord</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#204a87;font-weight:bold">range</span> <span style="color:#000">lambdaEvent</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Records</span> <span style="color:#000;font-weight:bold">{</span>
  <span style="color:#000">logger</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">WithFields</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">logrus</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Fields</span><span style="color:#000;font-weight:bold">{</span>
    <span style="color:#4e9a06">&#34;Keys&#34;</span><span style="color:#000;font-weight:bold">:</span>     <span style="color:#000">eachRecord</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">DynamoDB</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Keys</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#4e9a06">&#34;NewImage&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">eachRecord</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">DynamoDB</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">NewImage</span><span style="color:#000;font-weight:bold">,</span>
  <span style="color:#000;font-weight:bold">}).</span><span style="color:#000">Info</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;DynamoDb Event&#34;</span><span style="color:#000;font-weight:bold">)</span>
<span style="color:#000;font-weight:bold">}</span></code></pre></div>

<p>That&rsquo;s enough to get the data into CloudWatch Logs.</p>

<h1 id="a-href-hahahugoshortcode-5hbhb-sparta-integration-a"><a href="#spartaIntegration">Sparta Integration</a></h1>

<p>With the core of the <code>echoDynamoDBEvent</code> complete, the next step is to integrate the <strong>go</strong> function with Sparta.  This is performed by the <a href="https://github.com/mweagle/SpartaApplication/blob/master/application.go#L114">appendDynamoDBLambda</a> function.  Since the <code>echoDynamoDBEvent</code> function doesn&rsquo;t access any additional services (Sparta enables CloudWatch Logs privileges by default), the integration is pretty straightforward:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#000">lambdaFn</span> <span style="color:#ce5c00;font-weight:bold">:=</span> <span style="color:#000">sparta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">HandleAWSLambda</span><span style="color:#000;font-weight:bold">(</span>
  <span style="color:#000">sparta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">LambdaName</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">echoDynamoDBEvent</span><span style="color:#000;font-weight:bold">),</span>
  <span style="color:#000">http</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">HandlerFunc</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">echoDynamoDBEvent</span><span style="color:#000;font-weight:bold">),</span>
  <span style="color:#000">sparta</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">IAMRoleDefinition</span><span style="color:#000;font-weight:bold">{})</span></code></pre></div>

<h1 id="event-source-mappings">Event Source Mappings</h1>

<p>If we were to deploy this Sparta application, the <code>echoDynamoDBEvent</code> function would have the ability to log DynamoDB stream events, but would not be invoked in response to events published by the stream.  To register for notifications, we need to configure the lambda&rsquo;s <a href="http://docs.aws.amazon.com/lambda/latest/dg/intro-core-components.html#intro-core-components-event-sources">EventSourceMappings</a>:</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#000">lambdaFn</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">EventSourceMappings</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lambdaFn</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">EventSourceMappings</span><span style="color:#000;font-weight:bold">,</span>
    <span style="color:#ce5c00;font-weight:bold">&amp;</span><span style="color:#000">lambda</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">CreateEventSourceMappingInput</span><span style="color:#000;font-weight:bold">{</span>
      <span style="color:#000">EventSourceArn</span><span style="color:#000;font-weight:bold">:</span>   <span style="color:#000">aws</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">dynamoTestStream</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">StartingPosition</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">aws</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">String</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;TRIM_HORIZON&#34;</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">BatchSize</span><span style="color:#000;font-weight:bold">:</span>        <span style="color:#000">aws</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Int64</span><span style="color:#000;font-weight:bold">(</span><span style="color:#0000cf;font-weight:bold">10</span><span style="color:#000;font-weight:bold">),</span>
      <span style="color:#000">Enabled</span><span style="color:#000;font-weight:bold">:</span>          <span style="color:#000">aws</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">Bool</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#000;font-weight:bold">),</span>
  <span style="color:#000;font-weight:bold">})</span>
<span style="color:#000">lambdaFunctions</span> <span style="color:#000;font-weight:bold">=</span> <span style="color:#204a87">append</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">lambdaFunctions</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">lambdaFn</span><span style="color:#000;font-weight:bold">)</span></code></pre></div>

<p>The <code>dynamoTestStream</code> param is the ARN of the Dynamo stream that that your lambda function will <a href="http://docs.aws.amazon.com/lambda/latest/dg/intro-invocation-modes.html">poll</a> (eg: <em>arn:aws:dynamodb:us-west-2:000000000000:table/myDynamoDBTable/stream/2015-12-05T16:28:11.869</em>).</p>

<p>The <code>EventSourceMappings</code> field is transformed into the appropriate <a href="http://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-resource-lambda-eventsourcemapping.html">CloudFormation Resource</a> which enables automatic polling of the DynamoDB stream.</p>

<h1 id="wrapping-up">Wrapping Up</h1>

<p>With the <code>lambdaFn</code> fully defined, we can provide it to <code>sparta.Main()</code> and deploy our service.  The workflow below is shared by all DynamoDB stream based lambda functions:</p>

<ul>
<li>Define the lambda function (<code>echoDynamoDBEvent</code>).</li>
<li>If needed, create the required <a href="https://godoc.org/github.com/mweagle/Sparta*IAMRoleDefinition">IAMRoleDefinition</a> with appropriate privileges if the lambda function accesses other AWS services.</li>
<li>Provide the lambda function &amp; IAMRoleDefinition to <code>sparta.HandleAWSLambda()</code></li>
<li>Add the necessary <a href="https://godoc.org/github.com/aws/aws-sdk-go/service/lambda#CreateEventSourceMappingInput">EventSourceMappings</a> to the <code>LambdaAWSInfo</code> struct so that the lambda function is properly configured.</li>
</ul>

<h1 id="other-resources">Other Resources</h1>

<ul>
<li><a href="https://aws.amazon.com/blogs/aws/dynamodb-update-triggers-streams-lambda-cross-region-replication-app/">Using Triggers for Cross Region DynamoDB Replication</a></li>
</ul>

<hr />

<h1 id="appendix">Appendix</h1>

<h2 id="creating-a-dynamodb-stream">Creating a DynamoDB Stream</h2>

<p>To create a DynamoDB stream for a given table, follow the steps below:</p>

<h3 id="select-table">Select Table</h3>

<p><img src="http://gosparta.io/images/eventsources/dynamodb/DynamoDB_ManageStream.png" alt="Select Table" /></p>

<h3 id="enable-stream">Enable Stream</h3>

<p><img src="http://gosparta.io/images/eventsources/dynamodb/DynamoDB_Enable.png" alt="Enable Stream" /></p>

<h3 id="copy-arn">Copy ARN</h3>

<p><img src="http://gosparta.io/images/eventsources/dynamodb/DynamoDB_StreamARN.png" alt="Copy ARN" /></p>

<p>The <strong>Latest stream ARN</strong> value is the value that should be provided as the <code>EventSourceArn</code> in to the <a href="http://localhost:1313/docs/eventsources/dynamodb/#eventSourceMapping:d680e8a854a7cbad6d490c445cba2eba">Event Source Mappings</a>.</p>


			<aside class="copyright" role="note">
				
				&copy; 2018 Copyright 2015-2017 Matt Weagle &ndash;
				
				Last built at <b>2017-10-31 18:20:05 &#43;0000 UTC</b> with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="http://gosparta.io/docs/eventsources/cognito/" title="Event Source - Cognito">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Event Source - Cognito
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="http://gosparta.io/docs/eventsources/s3/" title="Event Source - S3">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Event Source - S3
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>


    <script>
    
      var base_url = 'http:\/\/gosparta.io\/';
      var repo_id  = 'mweagle\/Sparta';
    
    </script>

    <script src="http://gosparta.io/javascripts/application.js"></script>
    
    <script src="http://gosparta.io/external/mermaid_dist/mermaid.min.js"></script>
    
    <script src="http://gosparta.io/external/jquery/jquery-2.2.0.min.js"></script>
    

    
    <script>mermaid.initialize({startOnLoad:true});</script>


    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-70794971-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

  </body>
</html>

