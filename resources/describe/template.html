<!doctype html>
<html>
  <head>
    <title>{{ .ServiceName }}</title>

    <style>
      {{ .BootstrapCSS }}
    </style>

  	<style>
  	{{ .MermaidCSS }}
  	</style>

    <style>
      {{ .HighlightsCSS }}
    </style>

    <style>
      body {
        padding-top: 50px;
        margin-bottom: 60px;
        background-color: #F5F5F5;
      }

      .spartaLayout {
        font-family: "-apple-system", Menlo, Arial, Helvetica, sans-serif;
      }
    </style>
  	<script>
  	{{ .MermaidJS}}

  	mermaid.initialize({startOnLoad:true,
  										htmlLabels: true,
  									  flowchart:{
  									     useMaxWidth: true
  									  }
  										});


  	</script>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script charset="UTF-8">

     {{ .JQueryJS }}

    </script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script>

      {{ .BootstrapJS }}

    </script>

    <script>

      {{ .HighlightsJS }}

    </script>

    <script>
    var SERVICE_NAME = "{{ .ServiceName }}";

    var buildAPIGatewayRepresentation = function(template) {
      // For now see if we can find an API node...
      var data = {};
      resourceKeys = Object.keys(template.Resources);
      resourceKeys.forEach(function (eachKey) {
        var eachDefinition = template.Resources[eachKey];
        if (eachDefinition.Type === 'AWS::CloudFormation::CustomResource' &&
            eachDefinition.Properties &&
            eachDefinition.Properties.API) {
              data = eachDefinition.Properties.API;
            }
      });
      $("#rawAPIGatewayContent").text(JSON.stringify(data, null, ' '));
    };

    $( document ).ready(function() {
        var CLOUDFORMATION_TEMPLATE = null;
        try {
          CLOUDFORMATION_TEMPLATE = JSON.parse({{ .CloudFormationTemplate }});
        }
        catch (e)
        {
          console.log('Failed to parse template: ' + e.toString());
          CLOUDFORMATION_TEMPLATE = {
            ERROR: e.toString()
          };
        }
        buildAPIGatewayRepresentation(CLOUDFORMATION_TEMPLATE);
        $("#rawTemplateContent").text(JSON.stringify(CLOUDFORMATION_TEMPLATE, null, ' '));
        hljs.initHighlightingOnLoad();
    });
    </script>
  </head>
  <body>

    <div>
      <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
          <div class="navbar-header">
            <a class="navbar-brand" href="#">{{ .ServiceName }}</a>
          </div>
          <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
              <li class="active"><a href="#lambda" aria-controls="lambda" role="tab" data-toggle="tab">Lambdas</a></li>
              <li><a href="#apigateway" aria-controls="apigateway" role="tab" data-toggle="tab">API Gateway</a></li>
              <li><a href="#cloudformationTemplate" aria-controls="cloudformationTemplate" role="tab" data-toggle="tab">Template</a></li>
            </ul>
            <div id="navbar" class="navbar-collapse collapse">
              <form class="navbar-form navbar-right">
                Sparta version: {{.SpartaVersion}}
                <button type="submit" class="btn btn-info" onclick="window.open('https://github.com/mweagle/Sparta','_blank','resizable=yes')">Sparta Home</button>
              </form>
           </div>
          </div>
        </div>
      </nav>

      <div class="tab-content container-fluid">
        <div role="tabpanel" class="tab-pane active" id="lambda">
          <div class="mermaid spartaLayout" id="mermaidGraph">
        		%% Example code
        		graph LR

            {{ .MermaidData}}
        	</div>
        </div>
        <div role="tabpanel" class="tab-pane" id="apigateway">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2 class="panel-title">API Gateway <span class="label label-warning">TODO</span></h2>
            </div>
            <pre>
              <code class="JSON" id="rawAPIGatewayContent">
              </code>
            </pre>
          </div>
        </div>
        <div role="tabpanel" class="tab-pane" id="cloudformationTemplate">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h2 class="panel-title">CloudFormation Template</h2>
            </div>
            <pre>
              <code class="JSON" id="rawTemplateContent">
              </code>
            </pre>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
